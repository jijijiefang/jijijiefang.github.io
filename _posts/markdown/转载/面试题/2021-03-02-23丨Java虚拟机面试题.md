---
layout:     post
title:      "é¢è¯•é¢˜-23ä¸¨Javaè™šæ‹Ÿæœºé¢è¯•é¢˜"
date:       2021-03-02 09:50:40
author:     "jiefang"
header-style: text
tags:
    - è½¬è½½
    - é¢è¯•é¢˜
-----

#  Javaè™šæ‹Ÿæœºé¢è¯•é¢˜

ä»¥ä¸‹é¢è¯•é¢˜ï¼ŒåŸºäºç½‘ç»œæ•´ç†ï¼Œå’Œè‡ªå·±ç¼–è¾‘ã€‚å…·ä½“å‚è€ƒçš„æ–‡ç« ï¼Œä¼šåœ¨æ–‡æœ«ç»™å‡ºæ‰€æœ‰çš„é“¾æ¥ã€‚

å¦‚æœèƒ–å‹æœ‰è‡ªå·±çš„ç–‘é—®ï¼Œæ¬¢è¿åœ¨æ˜Ÿçƒæé—®ï¼Œæˆ‘ä»¬ä¸€èµ·æ•´ç†åŠåŠçš„ Javaã€è™šæ‹Ÿæœºã€‘é¢è¯•é¢˜çš„å¤§ä¿å¥ã€‚

è€Œé¢˜ç›®çš„éš¾åº¦ï¼Œè‰¿è‰¿å°½é‡æŒ‰ç…§ä»å®¹æ˜“åˆ°å›°éš¾çš„é¡ºåºï¼Œé€æ­¥ä¸‹å»ã€‚

å› ä¸º Java å¹¶å‘æ¶‰åŠåˆ°çš„å†…å®¹ä¼šéå¸¸å¤šï¼Œæœ¬é¢è¯•é¢˜å¯èƒ½å¾ˆéš¾è¦†ç›–åˆ°æ‰€æœ‰çš„çŸ¥è¯†ç‚¹ï¼Œæ‰€ä»¥æ¨è [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) ã€‚å¹¶ä¸”ï¼Œæœ¬æ–‡ä¼šå°†é¢è¯•é¢˜å’Œè¯¥ä¹¦çš„ç« èŠ‚ï¼Œå¤§ä½“ä¿æŒä¸€è‡´ã€‚å˜»å˜»~

å¦å¤–ï¼Œæœ¬æ–‡æ¶‰åŠçš„é¢è¯•é¢˜ä¼šè¶…çº§è¶…çº§è¶…çº§å¤šï¼Œæ‰€ä»¥è‰¿è‰¿å·²ç»åˆ†äº†å°èŠ‚ï¼Œèƒ–å‹è¦æ³¨æ„å“Ÿã€‚

å¯¹äºå¤§éƒ¨åˆ† JVM çš„é¢è¯•é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯æ¦‚å¿µé¢˜ï¼Œæ‰€ä»¥è‰¿è‰¿ä¸€äº›é¢è¯•é¢˜å¦‚æœå’Œ [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ç« èŠ‚ï¼Œä¼šè¿›è¡Œæ³¨æ˜ã€‚æ¯•ç«Ÿï¼Œçœ‹ä¹¦å¯ä»¥ç†è§£æ›´åŠ æ·±åˆ»ã€‚

> è‰¿è‰¿ï¼šå› ä¸ºå’Œå­—èŠ‚ç ã€æŒ‡ä»¤çº§ï¼Œç†è§£èµ·æ¥ç›¸å¯¹å¤æ‚ï¼Œå®é™…é¢è¯•é—®çš„ä¹Ÿç›¸å¯¹å°‘ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡æš‚æ—¶å…ˆä¸å†™ã€‚å½“ç„¶ï¼Œæœªæ¥è‚¯å®šè¦è¡¥çš„ï¼Œè¿™ä¹ˆæœ‰è¶£çš„ä¸œè¥¿ï¼Œèƒ–å‹è¯´æ˜¯ä¸æ˜¯ã€‚

# èµ°è¿‘ Java

## ä»€ä¹ˆæ˜¯è™šæ‹Ÿæœºï¼Ÿ

Java è™šæ‹Ÿæœºï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥æ‰§è¡Œ Java å­—èŠ‚ç çš„è™šæ‹Ÿæœºè¿›ç¨‹ã€‚Java æºæ–‡ä»¶è¢«ç¼–è¯‘æˆèƒ½è¢« Java è™šæ‹Ÿæœºæ‰§è¡Œçš„å­—èŠ‚ç æ–‡ä»¶( `.class` )ã€‚

Java è¢«è®¾è®¡æˆå…è®¸åº”ç”¨ç¨‹åºå¯ä»¥è¿è¡Œåœ¨ä»»æ„çš„å¹³å°ï¼Œè€Œä¸éœ€è¦ç¨‹åºå‘˜ä¸ºæ¯ä¸€ä¸ªå¹³å°å•ç‹¬é‡å†™æˆ–è€…æ˜¯é‡æ–°ç¼–è¯‘ã€‚Java è™šæ‹Ÿæœºè®©è¿™ä¸ªå˜ä¸ºå¯èƒ½ï¼Œå› ä¸ºå®ƒçŸ¥é“åº•å±‚ç¡¬ä»¶å¹³å°çš„æŒ‡ä»¤é•¿åº¦å’Œå…¶ä»–ç‰¹æ€§ã€‚

ä½†æ˜¯ï¼Œè·¨å¹³å°çš„æ˜¯ Java ç¨‹åº(åŒ…æ‹¬å­—èŠ‚ç æ–‡ä»¶)ï¼Œï¼Œè€Œä¸æ˜¯ JVMã€‚JVM æ˜¯ç”¨ C/C++ å¼€å‘çš„ï¼Œæ˜¯ç¼–è¯‘åçš„æœºå™¨ç ï¼Œä¸èƒ½è·¨å¹³å°ï¼Œä¸åŒå¹³å°ä¸‹éœ€è¦å®‰è£…ä¸åŒç‰ˆæœ¬çš„ JVM ã€‚

[![ä¸åŒå¹³å°ï¼Œä¸åŒ JVM](http://static.iocoder.cn/5f64c6b9436f6efbe54cfc2d01727301)](http://static.iocoder.cn/5f64c6b9436f6efbe54cfc2d01727301)ä¸åŒå¹³å°ï¼Œä¸åŒ JVM

- ä¹Ÿå°±æ˜¯è¯´ï¼ŒJVM èƒ½å¤Ÿè·¨è®¡ç®—æœºä½“ç³»ç»“æ„æ¥æ‰§è¡Œ Java å­—èŠ‚ç ï¼Œä¸»è¦æ˜¯ç”±äº JVM å±è”½äº†ä¸å„ä¸ªè®¡ç®—æœºå¹³å°ç›¸å…³çš„è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¹‹é—´çš„å·®å¼‚ï¼Œä½¿å¾—ä¸å¹³å°ç›¸å…³çš„è€¦åˆç»Ÿä¸€ç”± JVM æä¾›è€…æ¥å®ç°ã€‚

## JVM ç”±å“ªäº›éƒ¨åˆ†ç»„æˆï¼Ÿ

> è€ƒå¯Ÿå¯¹ JVM ä½“ç³»ç»“æ„çš„æŒæ¡
>
> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.2 è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

JVM çš„ç»“æ„åŸºæœ¬ä¸Šç”± 4 éƒ¨åˆ†ç»„æˆï¼š

> æ³¨æ„æ‰“é’©çš„ 4 ä¸ªåœ°æ–¹ã€‚

[![img](http://static.iocoder.cn/images/JDK/2020_02_10/01.jpg)](http://static.iocoder.cn/images/JDK/2020_02_10/01.jpg)

- **ç±»åŠ è½½å™¨**ï¼Œåœ¨ JVM å¯åŠ¨æ—¶æˆ–è€…ç±»è¿è¡Œæ—¶å°†éœ€è¦çš„ class åŠ è½½åˆ° JVM ä¸­ã€‚

- **å†…å­˜åŒº**ï¼Œå°†å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªåŒºä»¥æ¨¡æ‹Ÿå®é™…æœºå™¨ä¸Šçš„å­˜å‚¨ã€è®°å½•å’Œè°ƒåº¦åŠŸèƒ½æ¨¡å—ï¼Œå¦‚å®é™…æœºå™¨ä¸Šçš„å„ç§åŠŸèƒ½çš„å¯„å­˜å™¨æˆ–è€… PC æŒ‡é’ˆçš„è®°å½•å™¨ç­‰ã€‚

  > å…³äºè¿™ä¸€å—ï¼Œæˆ‘ä»¬åœ¨ [ã€ŒJava å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ä¹Ÿä¼šç»†çœ‹ã€‚

- **æ‰§è¡Œå¼•æ“**ï¼Œæ‰§è¡Œå¼•æ“çš„ä»»åŠ¡æ˜¯è´Ÿè´£æ‰§è¡Œ class æ–‡ä»¶ä¸­åŒ…å«çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œç›¸å½“äºå®é™…æœºå™¨ä¸Šçš„ CPU ã€‚

- **æœ¬åœ°æ–¹æ³•è°ƒç”¨**ï¼Œè°ƒç”¨ C æˆ– C++ å®ç°çš„æœ¬åœ°æ–¹æ³•çš„ä»£ç è¿”å›ç»“æœã€‚

## æ€æ ·é€šè¿‡ Java ç¨‹åºæ¥åˆ¤æ–­ JVM æ˜¯ 32 ä½ è¿˜æ˜¯ 64 ä½ï¼Ÿ

Sun æœ‰ä¸€ä¸ª Java System å±æ€§æ¥ç¡®å®šJVMçš„ä½æ•°ï¼š32 æˆ– 64ã€‚

- `sun.arch.data.model=32 // 32 bit JVM`
- `sun.arch.data.model=64 // 64 bit JVM`

æˆ‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥æ¥ç¡®å®š JVM æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½ï¼š

```
System.getProperty("sun.arch.data.model")
```

ğŸ¦… **32 ä½ JVM å’Œ 64 ä½ JVM çš„æœ€å¤§å †å†…å­˜åˆ†åˆ«æ˜¯å¤šæ•°ï¼Ÿ**

ç†è®ºä¸Šè¯´ä¸Š 32 ä½çš„ JVM å †å†…å­˜å¯ä»¥åˆ°è¾¾ 2^32ï¼Œå³ 4GB ï¼Œä½†å®é™…ä¸Šä¼šæ¯”è¿™ä¸ªå°å¾ˆå¤šã€‚ä¸åŒæ“ä½œç³»ç»Ÿä¹‹é—´ä¸åŒï¼Œå¦‚ Windows ç³»ç»Ÿå¤§çº¦ 1.5 GBï¼ŒSolaris å¤§çº¦ 3GBã€‚

64 ä½ JVM å…è®¸æŒ‡å®šæœ€å¤§çš„å †å†…å­˜ï¼Œç†è®ºä¸Šå¯ä»¥è¾¾åˆ° 2^64 ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°å­—ï¼Œå®é™…ä¸Šä½ å¯ä»¥æŒ‡å®šå †å†…å­˜å¤§å°åˆ° 100GB ã€‚ç”šè‡³æœ‰çš„ JVMï¼Œå¦‚ Azul ï¼Œå †å†…å­˜åˆ° 1000G éƒ½æ˜¯å¯èƒ½çš„ã€‚

ğŸ¦… **64 ä½ JVM ä¸­ï¼Œint çš„é•¿åº¦æ˜¯å¤šæ•°ï¼Ÿ**

Java ä¸­ï¼Œint ç±»å‹å˜é‡çš„é•¿åº¦æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œä¸å¹³å°æ— å…³ï¼Œéƒ½æ˜¯ 32 ä½æˆ–è€… 4 ä¸ªå­—èŠ‚ã€‚æ„æ€å°±æ˜¯è¯´ï¼Œåœ¨ 32 ä½ å’Œ 64 ä½ çš„Java è™šæ‹Ÿæœºä¸­ï¼Œint ç±»å‹çš„é•¿åº¦æ˜¯ç›¸åŒçš„ã€‚

# Java å†…å­˜åŒºåŸŸä¸å†…å­˜æº¢å‡ºå¼‚å¸¸

## JVM è¿è¡Œå†…å­˜çš„åˆ†ç±»ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.3.1 å¯¹è±¡çš„åˆ›å»ºã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

JVM è¿è¡Œå†…å­˜çš„åˆ†ç±»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

> æ³¨æ„ï¼Œè¿™ä¸ªå›¾æ˜¯åŸºäº JDK6 ç‰ˆæœ¬çš„è¿è¡Œå†…å­˜çš„åˆ†ç±»ã€‚

[![img](http://static.iocoder.cn/images/JDK/2020_02_10/02.png)](http://static.iocoder.cn/images/JDK/2020_02_10/02.png)

- ç¨‹åºè®¡æ•°å™¨

  ï¼š Java çº¿ç¨‹ç§æœ‰ï¼Œç±»ä¼¼äºæ“ä½œç³»ç»Ÿé‡Œçš„ PC è®¡æ•°å™¨ï¼Œå®ƒå¯ä»¥çœ‹åšæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚

  - å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ª Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚
  - æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½• OutOfMemoryError æƒ…å†µçš„åŒºåŸŸã€‚

- è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå†…å­˜ï¼‰

  ï¼šJavaçº¿ç¨‹ç§æœ‰ï¼Œè™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼š

  - æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ“ä½œæ•°ã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚
  - æ¯ä¸ªæ–¹æ³•è°ƒç”¨éƒ½æ„å‘³ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚

- **æœ¬åœ°æ–¹æ³•æ ˆ** ï¼šå’Œ Java è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯è¯¥åŒºåŸŸä¸º JVM æä¾›ä½¿ç”¨ Native æ–¹æ³•çš„æœåŠ¡ã€‚

- å †å†…å­˜

  ï¼ˆçº¿ç¨‹å…±äº«ï¼‰ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—åŒºåŸŸï¼Œåƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚

  - ç›®å‰ä¸»è¦çš„åƒåœ¾å›æ”¶ç®—æ³•éƒ½æ˜¯åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹çš„æœ‰ Eden ç©ºé—´ã€From Survivor ç©ºé—´ã€To Survivor ç©ºé—´ç­‰ï¼Œé»˜è®¤æƒ…å†µä¸‹æ–°ç”Ÿä»£æŒ‰ç…§ `8:1:1` çš„æ¯”ä¾‹æ¥åˆ†é…ã€‚
  - æ ¹æ® Java è™šæ‹Ÿæœºè§„èŒƒçš„è§„å®šï¼ŒJava å †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œå°±åƒæˆ‘ä»¬çš„ç£ç›˜ä¸€æ ·ã€‚

- æ–¹æ³•åŒº

  ï¼ˆçº¿ç¨‹å…±äº«ï¼‰ï¼šå„ä¸ªçº¿ç¨‹å…±äº«çš„ä¸€ä¸ªåŒºåŸŸï¼Œç”¨äºå­˜å‚¨è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚

  - è™½ç„¶ Java è™šæ‹Ÿæœºè§„èŒƒæŠŠæ–¹æ³•åŒºæè¿°ä¸ºå †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒå´æœ‰ä¸€ä¸ªåˆ«åå«åš Non-Heapï¼ˆéå †ï¼‰ï¼Œç›®çš„åº”è¯¥æ˜¯ä¸ Java å †åŒºåˆ†å¼€æ¥ã€‚
  - è¿è¡Œæ—¶å¸¸é‡æ± ï¼šæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚

ğŸ¦… **ç›´æ¥å†…å­˜æ˜¯ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Ÿ**

å‚è§ [ã€ŠJVM ç›´æ¥å†…å­˜ã€‹](https://blog.csdn.net/leaf_0303/article/details/78961936) æ–‡ç« ã€‚

ç›´æ¥å†…å­˜(Direct Memory)ï¼Œå¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒä¸­å†œå®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚åœ¨ JDK1.4 ä¸­æ–°åŠ å…¥äº† NIO(New Input/Output) ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“(Channel)ä¸ç¼“å†²åŒºï¼ˆBufferï¼‰çš„ I/O æ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè„±ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †ä¸­çš„ DirectByteBuffer å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚

- æœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †å¤§å°çš„é™åˆ¶ï¼Œå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°é™åˆ¶ã€‚
- é…ç½®è™šæ‹Ÿæœºå‚æ•°æ—¶ï¼Œä¸è¦å¿½ç•¥ç›´æ¥å†…å­˜ï¼Œé˜²æ­¢å‡ºç° OutOfMemoryError å¼‚å¸¸ã€‚

ğŸ¦… **ç›´æ¥å†…å­˜ï¼ˆå †å¤–å†…å­˜ï¼‰ä¸å †å†…å­˜æ¯”è¾ƒï¼Ÿ**

1. ç›´æ¥å†…å­˜ç”³è¯·ç©ºé—´è€—è´¹æ›´é«˜çš„æ€§èƒ½ï¼Œå½“é¢‘ç¹ç”³è¯·åˆ°ä¸€å®šé‡æ—¶å°¤ä¸ºæ˜æ˜¾ã€‚
2. ç›´æ¥å†…å­˜ IO è¯»å†™çš„æ€§èƒ½è¦ä¼˜äºæ™®é€šçš„å †å†…å­˜ï¼Œåœ¨å¤šæ¬¡è¯»å†™æ“ä½œçš„æƒ…å†µä¸‹å·®å¼‚æ˜æ˜¾ã€‚

ğŸ¦… **å®é™…ä¸Šï¼Œåç»­çš„ç‰ˆæœ¬ï¼Œä¸»è¦å¯¹ã€æ–¹æ³•åŒºã€‘åšäº†ä¸€å®šçš„è°ƒæ•´**

- JDK7 çš„æ”¹å˜

  - å­˜å‚¨åœ¨æ°¸ä¹…ä»£çš„éƒ¨åˆ†æ•°æ®å°±å·²ç»è½¬ç§»åˆ°äº† Java Heap æˆ–è€…æ˜¯ Native Heapã€‚ä½†æ°¸ä¹…ä»£ä»å­˜åœ¨äº JDK7 ä¸­ï¼Œä½†æ˜¯å¹¶æ²¡å®Œå…¨ç§»é™¤ã€‚
  - å¸¸é‡æ± å’Œé™æ€å˜é‡æ”¾åˆ° Java å †é‡Œã€‚

- JDK8 çš„æ”¹å˜

  - åºŸå¼ƒ PermGenï¼ˆæ°¸ä¹…ä»£ï¼‰ï¼Œæ–°å¢ Metaspaceï¼ˆå…ƒæ•°æ®åŒºï¼‰ã€‚

  - é‚£ä¹ˆæ–¹æ³•åŒºè¿˜åœ¨ä¹ˆï¼ŸFROM ç‹¼å“¥ çš„è§£ç­”ï¼šæ–¹æ³•åŒºåœ¨ Metaspace ä¸­äº†ï¼Œæ–¹æ³•åŒºéƒ½æ˜¯ä¸€ä¸ªæ¦‚å¿µçš„ä¸œè¥¿ã€‚ğŸ˜ˆ ç‹¼å“¥é€šè¿‡æ’¸æºç è·å¾—è¯¥ä¿¡æ¯ã€‚

    > å› ä¸ºï¼Œã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹åªæ˜¯è§„å®šäº†æœ‰æ–¹æ³•åŒºè¿™ä¹ˆä¸ªæ¦‚å¿µå’Œå®ƒçš„ä½œç”¨ï¼Œå¹¶æ²¡æœ‰è§„å®šå¦‚ä½•å»å®ç°å®ƒã€‚é‚£ä¹ˆï¼Œåœ¨ä¸åŒçš„ JVM ä¸Šæ–¹æ³•åŒºçš„å®ç°è‚¯å®šæ˜¯ä¸åŒçš„äº†ã€‚
    >
    > åŒæ—¶ï¼Œå¤§å¤šæ•°ç”¨çš„ JVM éƒ½æ˜¯ Sun å…¬å¸çš„ HotSpot ã€‚åœ¨ HotSpot ä¸ŠæŠŠ GC åˆ†ä»£æ”¶é›†æ‰©å±•è‡³æ–¹æ³•åŒºï¼Œæˆ–è€…è¯´ä½¿ç”¨æ°¸ä¹…å¸¦æ¥å®ç°æ–¹æ³•åŒºã€‚

- å‚è€ƒæ–‡ç« 

  - [ã€ŠJVM å†…å­˜å †å¸ƒå±€å›¾è§£åˆ†æã€‹](https://www.cnblogs.com/SaraMoring/p/5713732.html)
  - [ã€Šç¬”è®°ä¹‹ JVM æ–¹æ³•åŒºï¼šæ°¸ä¹…å¸¦ VS å…ƒç©ºé—´ã€‹](https://www.jianshu.com/p/855b38c57925)
  - [ã€ŠJVM â€”â€” ç§»é™¤æ°¸ä¹…ä»£ã€‹](https://blog.csdn.net/wenniuwuren/article/details/51170275)
  - [ã€ŠJDK æºç å‰–æäº”ï¼šJDK8 â€”â€” åºŸå¼ƒæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰è¿æ¥å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‹](https://www.bbsmax.com/A/RnJW679gzq/)
  - [ã€ŠJava8 å†…å­˜æ¨¡å‹ â€”â€” æ°¸ä¹…ä»£(PermGen)å’Œå…ƒç©ºé—´(Metaspace)ã€‹](https://www.cnblogs.com/paddix/p/5309550.html)

ğŸ¦… **JDK8 ä¹‹å Perm Space æœ‰å“ªäº›å˜åŠ¨? MetaSpace â¼¤â¼©é»˜è®¤æ˜¯â½†é™çš„ä¹ˆ? è¿˜æ˜¯ä½ ä»¬ä¼šé€šè¿‡ä»€ä¹ˆâ½…å¼æ¥æŒ‡å®šâ¼¤â¼©?**

- JDK8 åç”¨å…ƒç©ºé—´æ›¿ä»£äº† Perm Space ï¼›å­—ç¬¦ä¸²å¸¸é‡å­˜æ”¾åˆ°å †å†…å­˜ä¸­ã€‚
- MetaSpace å¤§å°é»˜è®¤æ²¡æœ‰é™åˆ¶ï¼Œä¸€èˆ¬æ ¹æ®ç³»ç»Ÿå†…å­˜çš„å¤§å°ã€‚JVM ä¼šåŠ¨æ€æ”¹å˜æ­¤å€¼ã€‚
- å¯ä»¥é€šè¿‡ JVM å‚æ•°é…ç½®
  - `-XX:MetaspaceSize` ï¼š åˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´ï¼ˆä»¥å­—èŠ‚è®¡ï¼‰çš„åˆå§‹å¤§å°ï¼ˆOracle é€»è¾‘å­˜å‚¨ä¸Šçš„åˆå§‹é«˜æ°´ä½ï¼Œthe initial high-water-markï¼‰ã€‚æ­¤å€¼ä¸ºä¼°è®¡å€¼ï¼ŒMetaspaceSize çš„å€¼è®¾ç½®çš„è¿‡å¤§ä¼šå»¶é•¿åƒåœ¾å›æ”¶æ—¶é—´ã€‚åƒåœ¾å›æ”¶è¿‡åï¼Œå¼•èµ·ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶çš„ç±»å…ƒæ•°æ®ç©ºé—´çš„å¤§å°å¯èƒ½ä¼šå˜å¤§ã€‚
  - `-XX:MaxMetaspaceSize` ï¼šåˆ†é…ç»™ç±»å…ƒæ•°æ®ç©ºé—´çš„æœ€å¤§å€¼ï¼Œè¶…è¿‡æ­¤å€¼å°±ä¼šè§¦å‘Full GC ã€‚æ­¤å€¼é»˜è®¤æ²¡æœ‰é™åˆ¶ï¼Œä½†åº”å–å†³äºç³»ç»Ÿå†…å­˜çš„å¤§å°ï¼ŒJVM ä¼šåŠ¨æ€åœ°æ”¹å˜æ­¤å€¼ã€‚

ğŸ¦… **ä¸ºä»€ä¹ˆè¦åºŸå¼ƒæ°¸ä¹…ä»£ï¼Ÿ**

1ï¼‰ç°å®ä½¿ç”¨ä¸­æ˜“å‡ºé—®é¢˜ã€‚

ç”±äºæ°¸ä¹…ä»£å†…å­˜ç»å¸¸ä¸å¤Ÿç”¨æˆ–å‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œçˆ†å‡ºå¼‚å¸¸ `java.lang.OutOfMemoryError: PermGen` ã€‚

- å­—ç¬¦ä¸²å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡ºã€‚
- ç±»åŠæ–¹æ³•çš„ä¿¡æ¯ç­‰æ¯”è¾ƒéš¾ç¡®å®šå…¶å¤§å°ï¼Œå› æ­¤å¯¹äºæ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šæ¯”è¾ƒå›°éš¾ï¼Œå¤ªå°å®¹æ˜“å‡ºç°æ°¸ä¹…ä»£æº¢å‡ºï¼Œå¤ªå¤§åˆ™å®¹æ˜“å¯¼è‡´è€å¹´ä»£æº¢å‡ºã€‚

2ï¼‰æ°¸ä¹…ä»£ä¼šä¸º GC å¸¦æ¥ä¸å¿…è¦çš„å¤æ‚åº¦ï¼Œå¹¶ä¸”å›æ”¶æ•ˆç‡åä½ã€‚

3ï¼‰Oracle å¯èƒ½ä¼šå°†HotSpot ä¸ JRockit åˆäºŒä¸ºä¸€ã€‚

å‚ç…§ JEP122 ï¼šhttp://openjdk.java.net/jeps/122 ï¼ŒåŸæ–‡æˆªå–ï¼š

> Motivation
>
> This is part of the JRockit and Hotspot convergence effort. JRockit customers do not need to configure the permanent generation (since JRockit does not have a permanent generation) and are accustomed to not configuring the permanent generation.

å³ï¼šç§»é™¤æ°¸ä¹…ä»£æ˜¯ä¸ºèåˆ HotSpot JVM ä¸ JRockit VM è€Œåšå‡ºçš„åŠªåŠ›ï¼Œå› ä¸º JRockit æ²¡æœ‰æ°¸ä¹…ä»£ï¼Œä¸éœ€è¦é…ç½®æ°¸ä¹…ä»£ã€‚

## Java å†…å­˜å †å’Œæ ˆåŒºåˆ«ï¼Ÿ

- æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼›å †å†…å­˜ç”¨æ¥å­˜å‚¨Javaä¸­çš„å¯¹è±¡ï¼Œæ— è®ºæ˜¯æˆå‘˜å˜é‡ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿˜æ˜¯ç±»å˜é‡ï¼Œå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚
- æ ˆå†…å­˜å½’å±äºå•ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå†…å­˜ï¼Œå…¶å­˜å‚¨çš„å˜é‡åªèƒ½åœ¨å…¶æ‰€å±çº¿ç¨‹ä¸­å¯è§ï¼Œå³æ ˆå†…å­˜å¯ä»¥ç†è§£æˆçº¿ç¨‹çš„ç§æœ‰å†…å­˜ï¼›å †å†…å­˜ä¸­çš„å¯¹è±¡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚å †å†…å­˜ä¸­çš„å¯¹è±¡å¯ä»¥è¢«æ‰€æœ‰çº¿ç¨‹è®¿é—®ã€‚
- å¦‚æœæ ˆå†…å­˜æ²¡æœ‰å¯ç”¨çš„ç©ºé—´å­˜å‚¨æ–¹æ³•è°ƒç”¨å’Œå±€éƒ¨å˜é‡ï¼ŒJVM ä¼šæŠ›å‡º `java.lang.StackOverFlowError` é”™è¯¯ï¼›å¦‚æœæ˜¯å †å†…å­˜æ²¡æœ‰å¯ç”¨çš„ç©ºé—´å­˜å‚¨ç”Ÿæˆçš„å¯¹è±¡ï¼ŒJVM ä¼šæŠ›å‡º `java.lang.OutOfMemoryError` é”™è¯¯ã€‚
- æ ˆçš„å†…å­˜è¦è¿œè¿œå°äºå †å†…å­˜ï¼Œå¦‚æœä½ ä½¿ç”¨é€’å½’çš„è¯ï¼Œé‚£ä¹ˆä½ çš„æ ˆå¾ˆå¿«å°±ä¼šå……æ»¡ã€‚`-Xss` é€‰é¡¹è®¾ç½®æ ˆå†…å­˜çš„å¤§å°ï¼Œ`-Xms` é€‰é¡¹å¯ä»¥è®¾ç½®å †çš„å¼€å§‹æ—¶çš„å¤§å°ã€‚

å½“ç„¶ï¼Œå¦‚æœä½ è®°ä¸ä½è¿™ä¸ªäº›ï¼Œåªè¦è®°ä½å¦‚ä¸‹å³å¯ï¼š

> JVM ä¸­å †å’Œæ ˆå±äºä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œä½¿ç”¨ç›®çš„ä¹Ÿä¸åŒã€‚æ ˆå¸¸ç”¨äºä¿å­˜æ–¹æ³•å¸§å’Œå±€éƒ¨å˜é‡ï¼Œè€Œå¯¹è±¡æ€»æ˜¯åœ¨å †ä¸Šåˆ†é…ã€‚æ ˆé€šå¸¸éƒ½æ¯”å †å°ï¼Œä¹Ÿä¸ä¼šåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œè€Œå †è¢«æ•´ä¸ª JVM çš„æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚

[![img](http://static.iocoder.cn/images/JDK/2020_02_10/03.png)](http://static.iocoder.cn/images/JDK/2020_02_10/03.png)

## JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.3.1 å¯¹è±¡çš„åˆ›å»ºã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚
>
> æ³¨æ„ï¼ŒåŠ ç²—çš„æ–‡å­—éƒ¨åˆ†ã€‚

JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š[![JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹](http://static.iocoder.cn/images/JDK/2020_02_10/06.png)](http://static.iocoder.cn/images/JDK/2020_02_10/06.png)JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹

- Java ä¸­å¯¹è±¡çš„åˆ›å»ºå°±æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜ç©ºé—´çš„è¿‡ç¨‹ï¼Œæ­¤å¤„è¯´çš„å¯¹è±¡åˆ›å»ºä»…é™äº new å…³é”®å­—åˆ›å»ºçš„æ™®é€š Java å¯¹è±¡ï¼Œä¸åŒ…æ‹¬æ•°ç»„å¯¹è±¡çš„åˆ›å»ºã€‚

1ï¼‰æ£€æµ‹ç±»æ˜¯å¦è¢«åŠ è½½

å½“è™šæ‹Ÿæœºé‡åˆ° `new` æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­**å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨**ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±æ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ã€‚

2ï¼‰ä¸ºå¯¹è±¡åˆ†é…å†…å­˜

ç±»åŠ è½½å®Œæˆä»¥åï¼Œè™šæ‹Ÿæœºå°±å¼€å§‹ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶æ‰€éœ€å†…å­˜çš„å¤§å°å°±å·²ç»ç¡®å®šäº†ã€‚åªéœ€è¦åœ¨å †ä¸Šåˆ†é…æ‰€éœ€è¦çš„å†…å­˜å³å¯ã€‚

å…·ä½“çš„åˆ†é…å†…å­˜æœ‰ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§æƒ…å†µæ˜¯å†…å­˜ç©ºé—´ç»å¯¹è§„æ•´ï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯å†…å­˜ç©ºé—´æ˜¯ä¸è¿ç»­çš„ã€‚

- å¯¹äºå†…å­˜ç»å¯¹è§„æ•´çš„æƒ…å†µç›¸å¯¹ç®€å•ä¸€äº›ï¼Œè™šæ‹Ÿæœºåªéœ€è¦åœ¨è¢«å ç”¨çš„å†…å­˜å’Œå¯ç”¨ç©ºé—´ä¹‹é—´ç§»åŠ¨æŒ‡é’ˆå³å¯ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºâ€œ**æŒ‡é’ˆç¢°æ’**â€ã€‚
- å¯¹äºå†…å­˜ä¸è§„æ•´çš„æƒ…å†µç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¥è®°å½•å“ªäº›å†…å­˜æ˜¯å¯ç”¨çš„ã€‚åˆ†é…å†…å­˜çš„æ—¶å€™éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„å†…å­˜ç©ºé—´ï¼Œç„¶ååœ¨åˆ—è¡¨ä¸Šè®°å½•ä¸‹å·²è¢«åˆ†é…ï¼Œè¿™ç§æ–¹å¼æˆä¸ºâ€œ**ç©ºé—²åˆ—è¡¨**â€ã€‚

å¤šçº¿ç¨‹å¹¶å‘æ—¶ä¼šå‡ºç°æ­£åœ¨ç»™å¯¹è±¡ A åˆ†é…å†…å­˜ï¼Œè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹æŒ‡é’ˆï¼Œå¯¹è±¡ B åˆç”¨è¿™ä¸ªæŒ‡é’ˆ**åˆ†é…å†…å­˜**ï¼Œè¿™æ ·å°±å‡ºç°é—®é¢˜äº†ã€‚è§£å†³è¿™ç§é—®é¢˜æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š

- ç¬¬ä¸€ç§ï¼Œæ˜¯é‡‡ç”¨åŒæ­¥çš„åŠæ³•ï¼Œä½¿ç”¨ CAS æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚
- å¦ä¸€ç§ï¼Œæ˜¯æ¯ä¸ªçº¿ç¨‹åˆ†é…å†…å­˜éƒ½åœ¨è‡ªå·±çš„ç©ºé—´å†…è¿›è¡Œï¼Œå³æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨å †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local Allocation Buffer, TLABï¼‰ï¼Œåˆ†é…å†…å­˜çš„æ—¶å€™å†TLABä¸Šåˆ†é…ï¼Œäº’ä¸å¹²æ‰°ã€‚å¯ä»¥é€šè¿‡ `-XX:+/-UseTLAB` å‚æ•°å†³å®šã€‚

3ï¼‰ä¸ºåˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–é›¶å€¼

å¯¹è±¡çš„å†…å­˜åˆ†é…å®Œæˆåï¼Œè¿˜éœ€è¦å°†å¯¹è±¡çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œè¿™æ ·èƒ½ä¿è¯å¯¹è±¡å³ä½¿æ²¡æœ‰èµ‹åˆå€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

4ï¼‰å¯¹å¯¹è±¡è¿›è¡Œå…¶ä»–è®¾ç½®

åˆ†é…å®Œå†…å­˜ç©ºé—´ï¼Œåˆå§‹åŒ–é›¶å€¼ä¹‹åï¼Œè™šæ‹Ÿæœºè¿˜éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œå…¶ä»–å¿…è¦çš„è®¾ç½®ï¼Œè®¾ç½®çš„åœ°æ–¹éƒ½åœ¨å¯¹è±¡å¤´ä¸­ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ï¼Œç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¯¹è±¡çš„ hashcode ï¼ŒGC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚

5ï¼‰æ‰§è¡Œ init æ–¹æ³•

æ‰§è¡Œå®Œä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œåœ¨è™šæ‹Ÿæœºé‡Œè¿™ä¸ªå¯¹è±¡å°±ç®—åˆ›å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯å¯¹äº Java ç¨‹åºæ¥è¯´è¿˜éœ€è¦æ‰§è¡Œ init æ–¹æ³•æ‰ç®—çœŸæ­£çš„åˆ›å»ºå®Œæˆï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™å¯¹è±¡åªæ˜¯è¢«åˆå§‹åŒ–é›¶å€¼äº†ï¼Œè¿˜æ²¡æœ‰çœŸæ­£çš„å»æ ¹æ®ç¨‹åºä¸­çš„ä»£ç åˆ†é…åˆå§‹å€¼ï¼Œè°ƒç”¨äº† init æ–¹æ³•ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡æ‰çœŸæ­£èƒ½ä½¿ç”¨ã€‚

åˆ°æ­¤ä¸ºæ­¢ä¸€ä¸ªå¯¹è±¡å°±äº§ç”Ÿäº†ï¼Œè¿™å°±æ˜¯ new å…³é”®å­—åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š

[![JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹](http://static.iocoder.cn/images/JDK/2020_02_10/07.png)](http://static.iocoder.cn/images/JDK/2020_02_10/07.png)JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹

> å¦å¤–ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œé¢è¯•å®˜å¯èƒ½å¼•ç”³æˆ â€œ`A a = new A()` ç»å†è¿‡ä»€ä¹ˆè¿‡ç¨‹â€çš„é—®é¢˜ã€‚

## å¯¹è±¡çš„å†…å­˜å¸ƒå±€æ˜¯æ€æ ·çš„ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.3.2 å¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

å¯¹è±¡çš„å†…å­˜å¸ƒå±€åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š

- å¯¹è±¡å¤´ï¼šå¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚
  - ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ˜¯å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ŒGC åˆ†ä»£å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ç­‰ç­‰ã€‚
  - ç¬¬äºŒéƒ¨åˆ†ï¼Œæ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆã€‚
- å®ä¾‹æ•°æ®ï¼šå°±æ˜¯æ•°æ®ã€‚
- å¯¹é½å¡«å……ï¼šä¸æ˜¯å¿…ç„¶çš„å­˜åœ¨ï¼Œå°±æ˜¯ä¸ºäº†å¯¹é½ã€‚

## å¯¹è±¡æ˜¯å¦‚ä½•å®šä½è®¿é—®çš„ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.3.3 å¯¹è±¡çš„è®¿é—®å®šä½ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

å¯¹è±¡çš„è®¿é—®å®šä½æœ‰ä¸¤ç§ï¼š

- å¥æŸ„å®šä½ï¼šJava å †ä¼šç”»å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚[![å¥æŸ„å®šä½](http://static.iocoder.cn/images/JDK/2020_02_10/04.png)](http://static.iocoder.cn/images/JDK/2020_02_10/04.png)å¥æŸ„å®šä½
- ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼šJava å †å¯¹è±¡çš„ä¸å±…ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œ reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ã€‚[![ç›´æ¥æŒ‡é’ˆè®¿é—®](http://static.iocoder.cn/images/JDK/2020_02_10/05.png)](http://static.iocoder.cn/images/JDK/2020_02_10/05.png)ç›´æ¥æŒ‡é’ˆè®¿é—®

ğŸ¦… **å¯¹æ¯”ä¸¤ç§æ–¹å¼ï¼Ÿ**

è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚

- ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„ï¼Œå°±æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ˜¯éå¸¸æ™®éçš„è¡Œä¸ºï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚
- ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼çš„æœ€å¤§å¥½å¤„å°±æ˜¯é€Ÿåº¦æ›´å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ï¼Œç”±äºå¯¹è±¡çš„è®¿é—®åœ¨ Java ä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤è¿™ç±»å¼€é”€ç§¯å°‘æˆå¤šåä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¯è§‚çš„æ‰§è¡Œæˆæœ¬ã€‚

æˆ‘ä»¬ç›®å‰ä¸»è¦è™šæ‹Ÿæœº Sun HotSpot è€Œè¨€ï¼Œå®ƒæ˜¯ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼è¿›è¡Œå¯¹è±¡è®¿é—®çš„ï¼Œä½†ä»æ•´ä¸ªè½¯ä»¶å¼€å‘çš„èŒƒå›´æ¥çœ‹ï¼Œå„ç§è¯­è¨€å’Œæ¡†æ¶ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æƒ…å†µä¹Ÿååˆ†å¸¸è§ã€‚

## æœ‰å“ªäº› OutOfMemoryError å¼‚å¸¸ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ2.4 å®æˆ˜ï¼šOutOfMemoryError å¼‚å¸¸ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

åœ¨ Java è™šæ‹Ÿæœºä¸­è§„èŒƒçš„æè¿°ä¸­ï¼Œé™¤äº†ç¨‹åºè®¡æ•°å™¨å¤–ï¼Œè™šæ‹Ÿæœºå†…å­˜çš„å…¶å®ƒå‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸéƒ½æœ‰å‘ç”Ÿçš„ OutOfMemoryError(ç®€ç§°ä¸ºâ€œOOMâ€) å¼‚å¸¸çš„å¯èƒ½ã€‚

- Java å †æº¢å‡º

- è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º

- æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º

  > ä» JDK8 å¼€å§‹ï¼Œå°±å˜æˆå…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡ºã€‚

- æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º

**1ï¼‰Java å †æº¢å‡º**

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJava å †æº¢å‡ºã€‹](https://blog.csdn.net/sells2012/article/details/18654915) æ–‡ç« ã€‚

å¦å¤–ï¼ŒJava å †æº¢å‡ºçš„åŸå› ï¼Œæœ‰å¯èƒ½æ˜¯å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨ MAT è¿›è¡Œåˆ†æã€‚

**2ï¼‰è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º**

ç”±äºåœ¨ HotSpot è™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå› æ­¤ï¼Œå¯¹äº HotSpot æ¥è¯´ï¼Œè™½ç„¶ `-Xoss` å‚æ•°ï¼ˆè®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼‰å­˜åœ¨ï¼Œä½†å®é™…ä¸Šæ˜¯æ— æ•ˆçš„ï¼Œæ ˆå®¹é‡åªç”± `-Xss`å‚æ•°è®¾å®šã€‚

å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š

- å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡º StackOverflowError å¼‚å¸¸ã€‚

  > StackOverflowError ä¸å±äº OOM å¼‚å¸¸å“ˆã€‚

- å¦‚æœè™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠOutOfMemoryError å¼‚å¸¸ â€”â€” è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡ºã€‹](https://blog.csdn.net/en_joker/article/details/79727675) æ–‡ç« ã€‚

**3ï¼‰è¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º**

å› ä¸º JDK7 å°†å¸¸é‡æ± å’Œé™æ€å˜é‡æ”¾åˆ° Java å †é‡Œï¼Œæ‰€ä»¥æ— æ³•è§¦å‘è¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºã€‚å¦‚æœæƒ³è¦è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ JDK6 çš„ç‰ˆæœ¬ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJVM å†…å­˜æº¢å‡º - æ–¹æ³•åŒºåŠè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºã€‹](https://www.niuhp.com/java/jvm-oom-pg.html) æ–‡ç« ã€‚

**4ï¼‰æ–¹æ³•åŒºçš„å†…å­˜æº¢å‡º**

å› ä¸º JDK8 å°†æ–¹æ³•åŒºæº¢å‡ºï¼Œæ‰€ä»¥æ— æ³•è§¦å‘æ–¹æ³•åŒºçš„å†…å­˜æº¢å‡ºæº¢å‡ºã€‚å¦‚æœæƒ³è¦è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ JDK7 çš„ç‰ˆæœ¬ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJava æ–¹æ³•åŒºæº¢å‡ºã€‹](https://blog.csdn.net/tanga842428/article/details/52636836) æ–‡ç« ã€‚

**5ï¼‰å…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡º**

å®é™…ä¸Šï¼Œæ–¹æ³•åŒºçš„å†…å­˜æº¢å‡ºåœ¨ JDK8 ä¸­ï¼Œå˜æˆäº†å…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡ºã€‚æ‰€ä»¥ï¼Œé‡ç°æ–¹å¼ï¼Œè¿˜æ˜¯å‚è§ [ã€ŠJava æ–¹æ³•åŒºæº¢å‡ºã€‹](https://blog.csdn.net/tanga842428/article/details/52636836) æ–‡ç« ï¼Œåªæ˜¯è¯´ï¼Œéœ€è¦å¢åŠ  `-XX:MaxMetaspaceSize=10m` VM é…ç½®é¡¹ã€‚

**6ï¼‰æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º**

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJVM å†…å­˜æº¢å‡º â€”â€” ç›´æ¥å†…å­˜æº¢å‡ºã€‹](https://www.niuhp.com/java/jvm-oom-direct.html) æ–‡ç« ã€‚

------

å¦å¤–ï¼Œéå¸¸æ¨èä¸€ç¯‡æ–‡ç« ï¼Œèƒ–å‹è€å¿ƒé˜…è¯»ï¼Œæä¾›äº†æ›´å¤šæœ‰è¶£çš„æ¡ˆä¾‹ï¼Œ[ã€ŠJava å†…å­˜æº¢å‡º(OOM)å¼‚å¸¸å®Œå…¨æŒ‡å—ã€‹](https://www.jianshu.com/p/2fdee831ed03) ã€‚

ğŸ¦… **å½“å‡ºç°äº†å†…å­˜æº¢å‡ºï¼Œä½ æ€ä¹ˆæ’é”™ï¼Ÿ**

- 1ã€é¦–å…ˆï¼Œæ§åˆ¶å°æŸ¥çœ‹é”™è¯¯æ—¥å¿—ã€‚
- 2ã€ç„¶åï¼Œä½¿ç”¨ JDK è‡ªå¸¦çš„ jvisualvm å·¥å…·æŸ¥çœ‹ç³»ç»Ÿçš„å †æ ˆæ—¥å¿—ã€‚
- 3ã€å®šä½å‡ºå†…å­˜æº¢å‡ºçš„ç©ºé—´ï¼šå †ï¼Œæ ˆè¿˜æ˜¯æ°¸ä¹…ä»£ï¼ˆJDK8 ä»¥åä¸ä¼šå‡ºç°æ°¸ä¹…ä»£çš„å†…å­˜æº¢å‡ºï¼‰ã€‚
  - å¦‚æœæ˜¯å †å†…å­˜æº¢å‡ºï¼Œçœ‹æ˜¯å¦åˆ›å»ºäº†è¶…å¤§çš„å¯¹è±¡ã€‚
  - å¦‚æœæ˜¯æ ˆå†…å­˜æº¢å‡ºï¼Œçœ‹æ˜¯å¦åˆ›å»ºäº†è¶…å¤§çš„å¯¹è±¡ï¼Œæˆ–è€…äº§ç”Ÿäº†æ­»å¾ªç¯ã€‚

## Java ä¸­ä¼šå­˜åœ¨å†…å­˜æ³„æ¼å—ï¼Ÿ

ç†è®ºä¸Š Java å› ä¸ºæœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ä¸ä¼šå­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜ï¼ˆè¿™ä¹Ÿæ˜¯ Java è¢«å¹¿æ³›ä½¿ç”¨äºæœåŠ¡å™¨ç«¯ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦åŸå› ï¼‰ã€‚ç„¶è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ— ç”¨ä½†å¯è¾¾çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸èƒ½è¢« GC å›æ”¶ä¹Ÿä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ã€‚ä¾‹å¦‚è¯´ï¼š

- Hibernate çš„ Sessionï¼ˆä¸€çº§ç¼“å­˜ï¼‰ä¸­çš„å¯¹è±¡å±äºæŒä¹…æ€ï¼Œåƒåœ¾å›æ”¶å™¨æ˜¯ä¸ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„ï¼Œç„¶è€Œè¿™äº›å¯¹è±¡ä¸­å¯èƒ½å­˜åœ¨æ— ç”¨çš„åƒåœ¾å¯¹è±¡ã€‚
- ä½¿ç”¨ Netty çš„å †å¤–çš„ ByteBuf å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨å®Œåï¼Œå¹¶æœªå½’è¿˜ï¼Œå¯¼è‡´ä½¿ç”¨çš„ä¸€ç‚¹ä¸€ç‚¹åœ¨æ³„éœ²ã€‚

# åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥

## ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.1 æ¦‚è¿°ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

- Java ä¸­å¯¹è±¡æ˜¯é‡‡ç”¨ `new` æˆ–è€…åå°„çš„æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯åœ¨å †(Heap)ä¸­åˆ†é…çš„ï¼Œæ‰€æœ‰å¯¹è±¡çš„å›æ”¶éƒ½æ˜¯ç”± Java è™šæ‹Ÿæœºé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å®Œæˆçš„ã€‚GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œä¼šç›‘æ§æ¯ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶å†µï¼Œå¯¹ä»–ä»¬çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰çŠ¶å†µè¿›è¡Œç›‘æ§ã€‚
- Java ç¨‹åºå‘˜ä¸ç”¨æ‹…å¿ƒå†…å­˜ç®¡ç†ï¼Œå› ä¸ºåƒåœ¾æ”¶é›†å™¨ä¼šè‡ªåŠ¨è¿›è¡Œç®¡ç†ã€‚
- å¯ä»¥è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ä¹‹ä¸€ï¼š`System#gc()` æˆ– `Runtime#getRuntime()#gc()` ï¼Œä½† JVM ä¹Ÿå¯ä»¥å±è”½æ‰æ˜¾ç¤ºçš„åƒåœ¾å›æ”¶è°ƒç”¨ã€‚

ğŸ¦… **ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨ç¨‹åºä¸­æ˜¾å¼çš„å£°æ˜ `System.gc()` ï¼Ÿ**

å› ä¸ºæ˜¾å¼å£°æ˜æ˜¯åšå †å†…å­˜å…¨æ‰«æï¼Œä¹Ÿå°±æ˜¯ Full GC ï¼Œæ˜¯éœ€è¦åœæ­¢æ‰€æœ‰çš„æ´»åŠ¨çš„(Stop The World Collection)ï¼Œå¯¹åº”ç”¨å¾ˆå¤§å¯èƒ½å­˜åœ¨å½±å“ã€‚

å¦å¤–ï¼Œè°ƒç”¨ `System.gc()` æ–¹æ³•åï¼Œä¸ä¼šç«‹å³æ‰§è¡Œ Full GC ï¼Œè€Œæ˜¯è™šæ‹Ÿæœºè‡ªå·±å†³å®šçš„ã€‚

ğŸ¦… **å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è¢«è®¾ç½®ä¸º `null` , GC ä¼šç«‹å³é‡Šæ”¾è¯¥å¯¹è±¡çš„å†…å­˜ä¹ˆ?**

ä¸ä¼š, è¿™ä¸ªå¯¹è±¡å°†ä¼šåœ¨ä¸‹ä¸€æ¬¡ GC å¾ªç¯ä¸­è¢«å›æ”¶ã€‚

ğŸ¦… **`#finalize()` æ–¹æ³•ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Ÿå®ƒçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ**

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.2.4 ç”Ÿå­˜è¿˜æ˜¯æ­»äº¡ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

`#finallize()` æ–¹æ³•ï¼Œæ˜¯åœ¨é‡Šæ”¾è¯¥å¯¹è±¡å†…å­˜å‰ç”± GC (åƒåœ¾å›æ”¶å™¨)è°ƒç”¨ã€‚

- é€šå¸¸å»ºè®®åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é‡Šæ”¾è¯¥å¯¹è±¡æŒæœ‰çš„èµ„æºï¼Œä¾‹å¦‚æŒæœ‰çš„å †å¤–å†…å­˜ã€å’Œè¿œç¨‹æœåŠ¡çš„é•¿è¿æ¥ã€‚
- ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®é‡å†™è¯¥æ–¹æ³•ã€‚
- å¯¹äºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥æ–¹æ³•æœ‰ä¸”ä»…ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚

## å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»æ­»å»ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.2 å¯¹è±¡å·²æ­»å—ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. å¼•ç”¨è®¡æ•°
2. å¯è¾¾æ€§åˆ†æ

**1ï¼‰å¼•ç”¨è®¡æ•°**

æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å±æ€§ï¼Œæ–°å¢ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°åŠ  1 ï¼Œå¼•ç”¨é‡Šæ”¾æ—¶è®¡æ•°å‡ 1 ï¼Œè®¡æ•°ä¸º 0 æ—¶å¯ä»¥å›æ”¶ã€‚æ­¤æ–¹æ³•ç®€å•ï¼Œæ— æ³•è§£å†³å¯¹è±¡ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ç›®å‰åœ¨ç”¨çš„æœ‰ Pythonã€ActionScript3 ç­‰è¯­è¨€ã€‚

**2ï¼‰å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰**

ä» GC Roots å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ä¸å¯è¾¾å¯¹è±¡ã€‚ç›®å‰åœ¨ç”¨çš„æœ‰ Javaã€C# ç­‰è¯­è¨€ã€‚

ğŸ¦… **å¦‚æœ A å’Œ B å¯¹è±¡å¾ªç¯å¼•ç”¨ï¼Œæ˜¯å¦å¯ä»¥è¢« GCï¼Ÿ**

å¯ä»¥ï¼Œå› ä¸º Java é‡‡ç”¨å¯è¾¾æ€§åˆ†æçš„åˆ¤æ–­æ–¹å¼ã€‚

ğŸ¦… **åœ¨ Java è¯­è¨€é‡Œï¼Œå¯ä½œä¸º GC Roots çš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼Ÿ**

1. è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚
2. æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚
3. æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚
4. æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI(å³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚

ğŸ¦… **æ–¹æ³•åŒºæ˜¯å¦èƒ½è¢«å›æ”¶ï¼Ÿ**

æ–¹æ³•åŒºå¯ä»¥è¢«å›æ”¶ï¼Œä½†æ˜¯ä»·å€¼å¾ˆä½ï¼Œä¸»è¦å›æ”¶åºŸå¼ƒçš„å¸¸é‡å’Œæ— ç”¨çš„ç±»ã€‚

å¦‚ä½•åˆ¤æ–­æ— ç”¨çš„ç±»ï¼Œéœ€è¦å®Œå…¨æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼š

1. è¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½è¢«å›æ”¶ï¼ˆJava å †ä¸­æ²¡æœ‰è¯¥ç±»çš„å¯¹è±¡ï¼‰ã€‚
2. åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚
3. è¯¥ç±»å¯¹åº”çš„ `java.lang.Class` å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹åˆ©ç”¨åå°„è®¿é—®è¯¥ç±»ã€‚

## Java å¯¹è±¡æœ‰å“ªäº›å¼•ç”¨ç±»å‹ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.2.3 å†è°ˆå¼•ç”¨ç±»å‹ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

Java ä¸€å…±æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼š

- å¼ºå¼•ç”¨
- è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰
- å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰
- è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰

**1ï¼‰å¼ºå¼•ç”¨**

ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚

> è‰¿è‰¿ï¼šä¸ç„¶ï¼Œä»£ç éƒ½æ²¡æ³•å†™äº† ğŸ˜ˆ

**2ï¼‰è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰**

å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯ç‰©çš„ç”Ÿæ´»ç”¨å“ã€‚å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚

è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼Œè§ [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” ç¼“å­˜æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/cache-package/) çš„ [ã€Œ2.10 SoftCacheã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚

**3ï¼‰å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰**

å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯ç‰©çš„ç”Ÿæ´»ç”¨å“ã€‚å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒ æ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚

å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼Œè§

- [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” ç¼“å­˜æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/cache-package/) çš„ [ã€Œ2.9 WeakCacheã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚
- [ã€Šç²¾å°½ Netty æºç è§£æ â€”â€” Buffer ä¹‹ ByteBufï¼ˆä¸‰ï¼‰å†…å­˜æ³„éœ²æ£€æµ‹ã€‹](http://svip.iocoder.cn/Netty/ByteBuf-1-3-ByteBuf-resource-leak-detector/) çš„ [ã€Œ4. ResourceLeakDetectorã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚

**4ï¼‰è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰**

â€œè™šå¼•ç”¨â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚

è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒ åœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚

------

å¦‚æœèƒ–å‹æƒ³çœ‹çœ‹å„ç§å¼•ç”¨åœ¨ GC ä¸‹çš„æ•ˆæœï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠJava ä¸­çš„å››ç§å¼•ç”¨ç±»å‹ã€‹](http://www.iocoder.cn/Fight/Four-reference-types-in-Java/?vip) æä¾›çš„ä»£ç ç¤ºä¾‹ã€‚

ğŸ¦… **WeakReference ä¸ SoftReferenceçš„åŒºåˆ«ï¼Ÿ**

è™½ç„¶ WeakReference ä¸ SoftReference éƒ½æœ‰åˆ©äºæé«˜ GC å’Œ å†…å­˜çš„æ•ˆç‡ã€‚

- ä½†æ˜¯ WeakReference ä¸€æ—¦å¤±å»æœ€åä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå°±ä¼šè¢« GC å›æ”¶
- è€Œ SoftReference è™½ç„¶ä¸èƒ½é˜»æ­¢è¢«å›æ”¶ï¼Œä½†æ˜¯å¯ä»¥å»¶è¿Ÿåˆ° JVM å†…å­˜ä¸è¶³çš„æ—¶å€™ã€‚

ğŸ¦… **ä¸ºä»€ä¹ˆè¦æœ‰ä¸åŒçš„å¼•ç”¨ç±»å‹ï¼Ÿ**

ä¸åƒ C è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œåœ¨ Java ä¸­æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é€‚å½“çš„æ§åˆ¶å¯¹è±¡è¢«å›æ”¶çš„æ—¶æœºï¼Œå› æ­¤å°±è¯ç”Ÿäº†ä¸åŒçš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥è¯´ä¸åŒçš„å¼•ç”¨ç±»å‹å®åˆ™æ˜¯å¯¹ GC å›æ”¶æ—¶æœºä¸å¯æ§çš„å¦¥åã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨åœºæ™¯å¯ä»¥å……åˆ†çš„è¯´æ˜ï¼š

- åˆ©ç”¨è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨è§£å†³ OOM é—®é¢˜ã€‚ç”¨ä¸€ä¸ª HashMap æ¥ä¿å­˜å›¾ç‰‡çš„è·¯å¾„å’Œç›¸åº”å›¾ç‰‡å¯¹è±¡å…³è”çš„è½¯å¼•ç”¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶è¿™äº›ç¼“å­˜å›¾ç‰‡å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº† OOM çš„é—®é¢˜.
- é€šè¿‡è½¯å¼•ç”¨å®ç° Java å¯¹è±¡çš„é«˜é€Ÿç¼“å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ Person çš„ç±»ï¼Œå¦‚æœæ¯æ¬¡éœ€è¦æŸ¥è¯¢ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼Œå“ªæ€•æ˜¯å‡ ç§’ä¸­ä¹‹å‰åˆšåˆšæŸ¥è¯¢è¿‡çš„ï¼Œéƒ½è¦é‡æ–°æ„å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™å°†å¼•èµ·å¤§é‡ Person å¯¹è±¡çš„æ¶ˆè€—ï¼Œå¹¶ä¸”ç”±äºè¿™äº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸å¯¹è¾ƒçŸ­ï¼Œä¼šå¼•èµ·å¤šæ¬¡ GC å½±å“æ€§èƒ½ã€‚æ­¤æ—¶ï¼Œé€šè¿‡è½¯å¼•ç”¨å’Œ HashMap çš„ç»“åˆå¯ä»¥æ„å»ºé«˜é€Ÿç¼“å­˜ï¼Œæä¾›æ€§èƒ½ã€‚

## JVM åƒåœ¾å›æ”¶ç®—æ³•ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.3 åƒåœ¾å›æ”¶ç®—æ³•ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

æœ‰å››ç§ç®—æ³•ï¼š

1. æ ‡è®°-æ¸…é™¤ç®—æ³•
2. æ ‡è®°-æ•´ç†ç®—æ³•
3. å¤åˆ¶ç®—æ³•
4. åˆ†ä»£æ”¶é›†ç®—æ³•

**1ï¼‰æ ‡è®°-æ¸…é™¤ç®—æ³•**

æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•ï¼Œæ˜¯ç°ä»£åƒåœ¾å›æ”¶ç®—æ³•çš„æ€æƒ³åŸºç¡€ã€‚

æ ‡è®°-æ¸…é™¤ç®—æ³•å°†åƒåœ¾å›æ”¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚

ä¸€ç§å¯è¡Œçš„å®ç°æ˜¯ï¼Œåœ¨æ ‡è®°é˜¶æ®µï¼Œé¦–å…ˆé€šè¿‡æ ¹èŠ‚ç‚¹ï¼Œæ ‡è®°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å¯è¾¾å¯¹è±¡ã€‚å› æ­¤ï¼Œæœªè¢«æ ‡è®°çš„å¯¹è±¡å°±æ˜¯æœªè¢«å¼•ç”¨çš„åƒåœ¾å¯¹è±¡ï¼ˆå¥½å¤šèµ„æ–™è¯´æ ‡è®°å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œå…¶å®æ˜ç™½å¤§æ¦‚æ„æ€å°±å¯ä»¥äº†ï¼‰ã€‚ç„¶åï¼Œåœ¨æ¸…é™¤é˜¶æ®µï¼Œæ¸…é™¤æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚

[![æ ‡è®°-æ¸…é™¤ç®—æ³•](http://static.iocoder.cn/f07ac7c68994aa21b7b4271073ea4e5b)](http://static.iocoder.cn/f07ac7c68994aa21b7b4271073ea4e5b)æ ‡è®°-æ¸…é™¤ç®—æ³•

- ç¼ºç‚¹ï¼š
  - 1ã€æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ã€‚
  - 2ã€ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§çš„å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚

**2ï¼‰æ ‡è®°-æ•´ç†ç®—æ³•**

æ ‡è®°æ•´ç†ç®—æ³•ï¼Œç±»ä¼¼ä¸æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œä¸è¿‡å®ƒæ ‡è®°å®Œå¯¹è±¡åï¼Œä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚

[![æ ‡è®°-æ•´ç†ç®—æ³•](http://static.iocoder.cn/52ea9a3813e09621c563b1cd4bdf0d22)](http://static.iocoder.cn/52ea9a3813e09621c563b1cd4bdf0d22)æ ‡è®°-æ•´ç†ç®—æ³•

- ä¼˜ç‚¹ï¼š
  - 1ã€ç›¸å¯¹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚
  - 2ã€æ²¡æœ‰å†…å­˜ç¢ç‰‡åï¼Œå¯¹è±¡åˆ›å»ºå†…å­˜åˆ†é…ä¹Ÿæ›´å¿«é€Ÿäº†ï¼ˆå¯ä»¥ä½¿ç”¨TLABè¿›è¡Œåˆ†é…ï¼‰ã€‚
- ç¼ºç‚¹ï¼š
  - 1ã€æ•ˆç‡é—®é¢˜ï¼Œï¼ˆåŒæ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰æ ‡è®°å’Œæ•´ç†ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ã€‚

**3ï¼‰å¤åˆ¶ç®—æ³•**

å¤åˆ¶ç®—æ³•ï¼Œå¯ä»¥è§£å†³æ•ˆç‡é—®é¢˜ï¼Œå®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ç»ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ï¼Œè¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼ˆè¿˜å¯ä½¿ç”¨TLABè¿›è¡Œé«˜æ•ˆåˆ†é…å†…å­˜ï¼‰ã€‚

[![å¤åˆ¶ç®—æ³•](http://static.iocoder.cn/cc3f228ca5353fd5deb4b22b7a9709e6)](http://static.iocoder.cn/cc3f228ca5353fd5deb4b22b7a9709e6)å¤åˆ¶ç®—æ³•

- å›¾çš„ä¸ŠåŠéƒ¨åˆ†æ˜¯æœªå›æ”¶å‰çš„å†…å­˜åŒºåŸŸï¼Œå›¾çš„ä¸‹åŠéƒ¨åˆ†æ˜¯å›æ”¶åçš„å†…å­˜åŒºåŸŸã€‚é€šè¿‡å›¾ï¼Œæˆ‘ä»¬å‘ç°ä¸ç®¡å›æ”¶å‰è¿˜æ˜¯å›æ”¶åéƒ½æœ‰ä¸€åŠçš„ç©ºé—´æœªè¢«åˆ©ç”¨ã€‚
- ä¼˜ç‚¹ï¼š
  - 1ã€æ•ˆç‡é«˜ï¼Œæ²¡æœ‰å†…å­˜ç¢ç‰‡ã€‚
- ç¼ºç‚¹ï¼š
  - 1ã€æµªè´¹ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚
  - 2ã€å¤åˆ¶æ”¶é›†ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ã€‚

**4ï¼‰åˆ†ä»£æ”¶é›†ç®—æ³•**

å½“å‰å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æŠŠ Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œç„¶åæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚

- åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œå°±é€‰ç”¨å¤åˆ¶ç®—æ³•ã€‚
- è€Œè€å¹´ä»£ä¸­ï¼Œå› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œæ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°æ¸…ç†â€æˆ–è€…â€œæ ‡è®°æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚

[![åˆ†ä»£æ”¶é›†ç®—æ³•](http://static.iocoder.cn/fec52af474f1250831d46b541e0fe7a9)](http://static.iocoder.cn/fec52af474f1250831d46b541e0fe7a9)åˆ†ä»£æ”¶é›†ç®—æ³•

- å›¾çš„å·¦åŠéƒ¨åˆ†æ˜¯æœªå›æ”¶å‰çš„å†…å­˜åŒºåŸŸï¼Œå³åŠéƒ¨åˆ†æ˜¯å›æ”¶åçš„å†…å­˜åŒºåŸŸã€‚
- å¯¹è±¡åˆ†é…ç­–ç•¥ï¼š
  - å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œå¦‚æœå¯¹è±¡è¿‡å¤§ç›´æ¥åˆ†é…åˆ° Old åŒºåŸŸã€‚
  - é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡è¿›å…¥åˆ° Old åŒºåŸŸã€‚
- æ”¹è¿›è‡ªå¤åˆ¶ç®—æ³•
  - ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼ŒIBM å…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ 98% æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§ `1:1` çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivor ã€‚å½“å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§åœ°å¤åˆ¶åˆ°å¦å¤–ä¸€å— Survivor ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰ Eden å’Œåˆšæ‰ç”¨è¿‡çš„ Survivor ç©ºé—´ã€‚
  - HotSpot è™šæ‹Ÿæœºé»˜è®¤ Eden å’Œ 2 å— Survivor çš„å¤§å°æ¯”ä¾‹æ˜¯ `8:1:1`ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„ 90%ï¼ˆ80%+10%ï¼‰ï¼Œåªæœ‰ 10% çš„å†…å­˜ä¼šè¢«â€œæµªè´¹â€ã€‚å½“ç„¶ï¼Œ98% çš„å¯¹è±¡å¯å›æ”¶åªæ˜¯ä¸€èˆ¬åœºæ™¯ä¸‹çš„æ•°æ®ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿è¯æ¯æ¬¡å›æ”¶éƒ½åªæœ‰ä¸å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œå½“ Survivor ç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–å†…å­˜ï¼ˆè¿™é‡ŒæŒ‡è€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚

## ä»€ä¹ˆæ˜¯å®‰å…¨ç‚¹ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.4.2 å®‰å…¨ç‚¹ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

SafePoint å®‰å…¨ç‚¹ï¼Œé¡¾åæ€ä¹‰æ˜¯æŒ‡ä¸€äº›ç‰¹å®šçš„ä½ç½®ï¼Œå½“çº¿ç¨‹è¿è¡Œåˆ°è¿™äº›ä½ç½®æ—¶ï¼Œçº¿ç¨‹çš„ä¸€äº›çŠ¶æ€å¯ä»¥è¢«ç¡®å®š(the threadâ€™s representation of itâ€™s Java machine state is well described)ï¼Œæ¯”å¦‚è®°å½•OopMap çš„çŠ¶æ€ï¼Œä»è€Œç¡®å®š GC Root çš„ä¿¡æ¯ï¼Œä½¿ JVM å¯ä»¥å®‰å…¨çš„è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å¼€å§‹ GC ã€‚

SafePoint æŒ‡çš„ç‰¹å®šä½ç½®ä¸»è¦æœ‰ï¼š

1. å¾ªç¯çš„æœ«å°¾ (é˜²æ­¢å¤§å¾ªç¯çš„æ—¶å€™ä¸€ç›´ä¸è¿›å…¥ Safepoint ï¼Œè€Œå…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…å®ƒè¿›å…¥ Safepoint )ã€‚
2. æ–¹æ³•è¿”å›å‰ã€‚
3. è°ƒç”¨æ–¹æ³•çš„ Call ä¹‹åã€‚
4. æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚

è¯¦ç»†çš„å†…å®¹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šæ·±å…¥å­¦ä¹  JVM-JVM å®‰å…¨ç‚¹å’Œå®‰å…¨åŒºåŸŸã€‹](https://my.oschina.net/wenbo123/blog/1822414) ã€‚

- å¦‚ä½•ä½¿çº¿ç¨‹ä¸­æ–­

  - ä¸»åŠ¨å¼

    > ä¸»åŠ¨å¼ JVM è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œçº¿ç¨‹å»æŒ‰ç…§æŸç§ç­–ç•¥æ£€æŸ¥è¿™ä¸ªå˜é‡ä¸€æ—¦å‘ç°æ˜¯ SafePoint å°±ä¸»åŠ¨æŒ‚èµ·ã€‚
    >
    > HostSpot è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯ä¸»åŠ¨å¼ä½¿çº¿ç¨‹ä¸­æ–­ã€‚

  - è¢«åŠ¨å¼

    > è¢«åŠ¨å¼å°±æ˜¯å‘ä¸ªä¿¡å·ï¼Œä¾‹å¦‚å…³æœºã€Control+C ï¼Œå¸¦æ¥çš„é—®é¢˜å°±æ˜¯ä¸å¯æ§ï¼Œå‘ä¿¡å·çš„æ—¶å€™ä¸çŸ¥é“çº¿ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚

- å®‰å…¨åŒºåŸŸ

  > å¦‚æœç¨‹åºé•¿æ—¶é—´ä¸æ‰§è¡Œï¼Œæ¯”å¦‚çº¿ç¨‹è°ƒç”¨çš„ sleep æ–¹æ³•ï¼Œè¿™æ—¶å€™ç¨‹åºæ— æ³•å“åº” JVM ä¸­æ–­è¯·æ±‚è¿™æ—¶å€™çº¿ç¨‹æ— æ³•åˆ°è¾¾å®‰å…¨ç‚¹ï¼Œæ˜¾ç„¶ JVM ä¹Ÿä¸å¯èƒ½ç­‰å¾…ç¨‹åºå”¤é†’ï¼Œè¿™æ—¶å€™å°±éœ€è¦å®‰å…¨åŒºåŸŸäº†ã€‚
  >
  > å®‰å…¨åŒºåŸŸæ˜¯æŒ‡ä¸€æ®µä»£ç ç‰‡ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä»»ä½•åœ°æ–¹ GC éƒ½æ˜¯å®‰å…¨çš„ï¼Œå®‰å…¨åŒºåŸŸå¯ä»¥çœ‹åšæ˜¯å®‰å…¨ç‚¹çš„ä¸€ä¸ªæ‰©å±•ã€‚
  >
  > - çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨åŒºåŸŸçš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†è‡ªå·±è¿›å…¥äº†å®‰å…¨åŒºåŸŸï¼Œè¿™æ · GC æ—¶å°±ä¸ç”¨ç®¡è¿›å…¥å®‰å…¨åŒºåŸŸçš„çº¿ç¨‹äº†.
  > - çº¿ç¨‹è¦ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶å°±æ£€æŸ¥ JVM æ˜¯å¦å®Œæˆäº† GC Roots æšä¸¾ï¼ˆæˆ–è€…æ•´ä¸ª GC è¿‡ç¨‹ï¼‰ï¼Œå¦‚æœå®Œæˆå°±ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å®Œæˆå°±ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€çš„ä¿¡å·ã€‚

## JVM åƒåœ¾æ”¶é›†å™¨æœ‰å“ªäº›ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.5 åƒåœ¾æ”¶é›†å™¨ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚

- æ–°ç”Ÿä»£æ”¶é›†å™¨

  - Serial æ”¶é›†å™¨

  - ParNew æ”¶é›†å™¨

    > ParNew æ”¶é›†å™¨ï¼Œæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆã€‚

  - Parallel Scavenge æ”¶é›†å™¨

- è€å¹´ä»£æ”¶é›†å™¨

  - Serial Old æ”¶é›†å™¨
    - Serial Old æ”¶é›†å™¨ï¼Œæ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚
  - Parallel Old æ”¶é›†å™¨
    - Parallel Old æ”¶é›†å™¨ï¼Œæ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚
  - CMS æ”¶é›†å™¨

- æ–°ç”Ÿä»£ + è€å¹´ä»£æ”¶é›†å™¨

  - G1 æ”¶é›†å™¨
  - ZGC æ”¶é›†å™¨

å°ç»“è¡¨æ ¼å¦‚ä¸‹ï¼š

| æ”¶é›†å™¨                | ä¸²è¡Œã€å¹¶è¡Œorå¹¶å‘ | æ–°ç”Ÿä»£/è€å¹´ä»£ | ç®—æ³•               | ç›®æ ‡         | é€‚ç”¨åœºæ™¯                                  |
| :-------------------- | :--------------- | :------------ | :----------------- | :----------- | :---------------------------------------- |
| **Serial**            | ä¸²è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼                   |
| **Serial Old**        | ä¸²è¡Œ             | è€å¹´ä»£        | æ ‡è®°-æ•´ç†          | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ã€CMSçš„åå¤‡é¢„æ¡ˆ    |
| **ParNew**            | å¹¶è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å¤šCPUç¯å¢ƒæ—¶åœ¨Serveræ¨¡å¼ä¸‹ä¸CMSé…åˆ        |
| **Parallel Scavenge** | å¹¶è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | ååé‡ä¼˜å…ˆ   | åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡          |
| **Parallel Old**      | å¹¶è¡Œ             | è€å¹´ä»£        | æ ‡è®°-æ•´ç†          | ååé‡ä¼˜å…ˆ   | åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡          |
| **CMS**               | å¹¶å‘             | è€å¹´ä»£        | æ ‡è®°-æ¸…é™¤          | å“åº”é€Ÿåº¦ä¼˜å…ˆ | é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–B/Sç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„Javaåº”ç”¨ |
| **G1**                | å¹¶å‘             | both          | æ ‡è®°-æ•´ç†+å¤åˆ¶ç®—æ³• | å“åº”é€Ÿåº¦ä¼˜å…ˆ | é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢CMS               |

å…³äºæ¯ç§åƒåœ¾æ”¶é›†å™¨çš„è¯´æ˜ï¼Œè¯·çœ‹ å¦‚ä¸‹æ–‡ç« ï¼š

- [ã€Šæ·±å…¥ç†è§£ JVM(3) â€”â€” 7 ç§åƒåœ¾æ”¶é›†å™¨ã€‹](https://crowhawk.github.io/2017/08/15/jvm_3/)
- [ã€Šä¸€æ–‡è¯»æ‡‚ Java 11 çš„ ZGC ä¸ºä½•å¦‚æ­¤é«˜æ•ˆã€‹](https://zhuanlan.zhihu.com/p/43608166)

ğŸ¦… **G1 å’Œ CMS çš„åŒºåˆ«ï¼Ÿ**

- CMS ï¼šå¹¶å‘æ ‡è®°æ¸…é™¤ã€‚ä»–çš„ä¸»è¦æ­¥éª¤æœ‰ï¼šåˆå§‹æ”¶é›†ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¹¶å‘æ¸…é™¤ï¼ˆåˆ é™¤ï¼‰ã€é‡ç½®ã€‚

- G1ï¼šä¸»è¦æ­¥éª¤ï¼šåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¤åˆ¶æ¸…é™¤ï¼ˆæ•´ç†ï¼‰

- CMS çš„ç¼ºç‚¹æ˜¯å¯¹ CPU çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚G1æ˜¯å°†å†…å­˜åŒ–æˆäº†å¤šå—ï¼Œæ‰€æœ‰å¯¹å†…æ®µçš„å¤§å°æœ‰å¾ˆå¤§çš„è¦æ±‚ã€‚

- CMSæ˜¯æ¸…é™¤ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨å¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ã€‚G1æ˜¯æ•´ç†ï¼Œæ‰€ä»¥ç¢ç‰‡ç©ºé—´è¾ƒå°ã€‚

- G1 å’Œ CMS éƒ½æ˜¯å“åº”ä¼˜å…ˆæŠŠï¼Œä»–ä»¬çš„ç›®çš„éƒ½æ˜¯å°½é‡æ§åˆ¶ STW æ—¶é—´ã€‚

  > G1 å’Œ CMS çš„ Full GC éƒ½æ˜¯å•çº¿ç¨‹ mark sweep compact ç®—æ³•ï¼Œç›´åˆ° JDK10 æ‰ä¼˜åŒ–ä¸ºå¹¶è¡Œçš„ã€‚

æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠGC ä¼˜åŒ–çš„ä¸€äº›æ€»ç»“ã€‹](http://engineering.xueqiu.com/blog/2015/06/25/jvm-gc-tuning/) çš„åˆ†æã€‚

ğŸ¦… **CMS ç®—æ³•çš„è¿‡ç¨‹ï¼ŒCMS å›æ”¶è¿‡ç¨‹ä¸­ JVM æ˜¯å¦éœ€è¦æš‚åœï¼Ÿ**

ä¼šæœ‰çŸ­æš‚çš„åœé¡¿ã€‚è¯¦ç»†çš„ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Š[jvm\][é¢è¯•] å¹¶å‘æ”¶é›†å™¨ CMS(Concurrent Mark-Sweep)ã€‹](https://blog.csdn.net/wfh6732/article/details/57490195) ã€‚

ğŸ¦… **å¦‚ä½•ä½¿ç”¨æŒ‡å®šçš„åƒåœ¾æ”¶é›†å™¨**

| é…ç½®                    | æè¿°                                     |
| :---------------------- | :--------------------------------------- |
| -XX:+UserSerialGC       | ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨                           |
| -XX:+UserParrallelGC    | å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨                           |
| -XX:+UseConcMarkSweepGC | å¹¶å‘æ ‡è®°æ‰«æåƒåœ¾å›æ”¶å™¨                   |
| -XX:ParallelCMSThreads  | å¹¶å‘æ ‡è®°æ‰«æåƒåœ¾å›æ”¶å™¨ =ä¸ºä½¿ç”¨çš„çº¿ç¨‹æ•°é‡ |
| -XX:+UseG1GC            | G1åƒåœ¾å›æ”¶å™¨                             |

## å¯¹è±¡åˆ†é…è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ3.6 å¯¹è±¡åˆ†é…ä¸å›æ”¶ç­–ç•¥ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

- å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨ Eden åŒºã€‚

  > å¦‚æœ Eden åŒºæ— æ³•åˆ†é…ï¼Œé‚£ä¹ˆå°è¯•æŠŠæ´»ç€çš„å¯¹è±¡æ”¾åˆ° Survivor0 ä¸­å»ï¼ˆMinor GCï¼‰
  >
  > - å¦‚æœ Survivor0 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ä¹‹åæ¸…é™¤ Eden åŒºã€‚
  > - å¦‚æœ Survivor0 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆå°è¯•æŠŠ Eden å’Œ Survivor0 çš„å­˜æ´»å¯¹è±¡æ”¾åˆ° Survivor1 ä¸­ã€‚
  >   - å¦‚æœ Survivor1 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ Survivor1 ä¹‹åæ¸…é™¤ Eden å’Œ Survivor0 ï¼Œä¹‹åå†æŠŠ Survivor1 ä¸­çš„å¯¹è±¡å¤åˆ¶åˆ° Survivor0 ä¸­ï¼Œä¿æŒ Survivor1 ä¸€ç›´ä¸ºç©ºã€‚
  >   - å¦‚æœ Survivor1 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆç›´æ¥æŠŠå®ƒä»¬æ”¾å…¥åˆ°è€å¹´ä»£ä¸­ï¼Œå¹¶æ¸…é™¤ Eden å’Œ Survivor0 ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸º**åˆ†é…æ‹…ä¿**ã€‚
  >
  > psï¼šæ¸…é™¤ Edenã€Survivor åŒºï¼Œå°±æ˜¯ Minor GC ã€‚
  >
  > æ€»ç»“æ¥è¯´ï¼Œåˆ†é…çš„é¡ºåºæ˜¯ï¼šæ–°ç”Ÿä»£ï¼ˆEden => Survivor0 => Survivor1ï¼‰=> è€å¹´ä»£

- å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚

  > è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œé¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´ï¼ˆæ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•æ”¶é›†å†…å­˜ï¼‰ã€‚

- é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚

  > è™šæ‹Ÿæœºä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå¦‚æœå¯¹è±¡ç»è¿‡äº† 1 æ¬¡ Minor GC é‚£ä¹ˆå¯¹è±¡ä¼šè¿›å…¥ Survivor åŒºï¼Œä¹‹åæ¯ç»è¿‡ä¸€æ¬¡ Minor GC é‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„åŠ  1 ï¼ŒçŸ¥é“è¾¾åˆ°é˜€å€¼å¯¹è±¡è¿›å…¥è€å¹´åŒºã€‚

- åŠ¨æ€åˆ¤æ–­å¯¹è±¡çš„å¹´é¾„ã€‚

  > ä¸ºäº†æ›´å¥½çš„é€‚ç”¨ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ã€‚
  >
  > å¦‚æœ Survivor åŒºä¸­ç›¸åŒå¹´é¾„çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚

- ç©ºé—´åˆ†é…æ‹…ä¿ã€‚

  > æ¯æ¬¡è¿›è¡Œ Minor GC æ—¶ï¼ŒJVM ä¼šè®¡ç®— Survivor åŒºç§»è‡³è€å¹´åŒºçš„å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äºè€å¹´åŒºçš„å‰©ä½™å€¼å¤§å°åˆ™è¿›è¡Œä¸€æ¬¡ Full GC ï¼Œå¦‚æœå°äºæ£€æŸ¥ HandlePromotionFailure è®¾ç½®ï¼Œå¦‚æœ `true` åˆ™åªè¿›è¡Œ Monitor GC ï¼Œå¦‚æœ `false` åˆ™è¿›è¡Œ Full GC ã€‚

å¦‚ä¸‹æ˜¯ä¸€å¼ å¯¹è±¡åˆ›å»ºæ—¶ï¼Œåˆ†é…å†…å­˜çš„å›¾ï¼š[![å†…å­˜åˆ†é…](http://static.iocoder.cn/bc22a30cbe93b8dedda080144a73b613)](http://static.iocoder.cn/bc22a30cbe93b8dedda080144a73b613)å†…å­˜åˆ†é…

ğŸ¦… **ä¸ºä»€ä¹ˆæ–°ç”Ÿä»£å†…å­˜éœ€è¦æœ‰ä¸¤ä¸ª Survivor åŒºï¼Ÿ**

è¯¦ç»†çš„åŸå› ï¼Œå¯ä»¥çœ‹ [ã€Šä¸ºä»€ä¹ˆæ–°ç”Ÿä»£å†…å­˜éœ€è¦æœ‰ä¸¤ä¸ª Survivor åŒºã€‹](https://blog.csdn.net/qq_27093465/article/details/79802884) æ–‡ç« ã€‚

## ä»€ä¹ˆæ˜¯æ–°ç”Ÿä»£ GC å’Œè€å¹´ä»£ GCï¼Ÿ

GC ç»å¸¸å‘ç”Ÿçš„åŒºåŸŸæ˜¯å †åŒºï¼Œå †åŒºè¿˜å¯ä»¥ç»†åˆ†ä¸º

[![å †](http://static.iocoder.cn/67796f9fc657b7b4dd0054f561248f5b)](http://static.iocoder.cn/67796f9fc657b7b4dd0054f561248f5b)å †

- æ–°ç”Ÿä»£
  - ä¸€ä¸ª Eden åŒº
  - ä¸¤ä¸ª Survivor åŒº
- è€å¹´ä»£

> é»˜è®¤æ–°ç”Ÿä»£(Young)ä¸è€å¹´ä»£(Old)çš„æ¯”ä¾‹çš„å€¼ä¸º `1:2` (è¯¥å€¼å¯ä»¥é€šè¿‡å‚æ•° `â€“XX:NewRatio` æ¥æŒ‡å®š)ã€‚
>
> é»˜è®¤çš„ `Eden:from:to=8:1:1` (å¯ä»¥é€šè¿‡å‚æ•° `â€“XX:SurvivorRatio` æ¥è®¾å®š)ã€‚

**æ–°ç”Ÿä»£GCï¼ˆMinorGC/YoungGCï¼‰**ï¼šæŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸º Java å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ MinorGC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚

**è€å¹´ä»£GCï¼ˆMajorGC/FullGCï¼‰**ï¼šæŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† MajorGCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ MinorGCï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨ Parallel Scavenge æ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡Œ MajorGC çš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰ã€‚MajorGC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” MinorGC æ…¢ 10 å€ä»¥ä¸Šã€‚

ğŸ¦… **ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç° Young GCï¼Ÿ**

å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­åˆ†é…ï¼Œå¦‚æœ Eden åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ Young GC ã€‚

ğŸ¦… **ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç° Full GCï¼Ÿ**

Full GC çš„è§¦å‘æ¡ä»¶æœ‰å¤šä¸ªï¼ŒFULL GC çš„æ—¶å€™ä¼š STOP THE WORD ã€‚

- 1ã€åœ¨æ‰§è¡Œ Young GC ä¹‹å‰ï¼ŒJVM ä¼šè¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿â€”â€”å¦‚æœè€å¹´ä»£çš„è¿ç»­ç©ºé—´å°äºæ–°ç”Ÿä»£å¯¹è±¡çš„æ€»å¤§å°ï¼ˆæˆ–å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼‰ï¼Œåˆ™è§¦å‘ä¸€æ¬¡ Full GC ã€‚
- 2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä»å¹´è½»ä»£æ™‹å‡ä¸Šæ¥çš„è€å¯¹è±¡ï¼Œå°è¯•åœ¨è€å¹´ä»£åˆ†é…å†…å­˜æ—¶ï¼Œä½†æ˜¯è€å¹´ä»£å†…å­˜ç©ºé—´ä¸å¤Ÿã€‚
- 3ã€æ˜¾å¼è°ƒç”¨ `System#gc()` æ–¹æ³•æ—¶ã€‚

# è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·

## JDK çš„å‘½ä»¤è¡Œå·¥å…·æœ‰å“ªäº›å¯ä»¥ç›‘æ§è™šæ‹Ÿæœºï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ4.2 JDK çš„å‘½ä»¤è¡Œå·¥å…·ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

- jps ï¼šè™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·

  > JVM Process Status Tool ï¼Œæ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚

- jstat ï¼šè™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘æ§å·¥å…·

  > JVM statistics Monitoring ï¼Œæ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚

- jinfo ï¼šJava é…ç½®ä¿¡æ¯å·¥å…·

  > JVM Configuration info ï¼Œè¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚

- jmap ï¼šJava å†…å­˜æ˜ å°„å·¥å…·

  > JVM Memory Map ï¼Œå‘½ä»¤ç”¨äºç”Ÿæˆ heap dump æ–‡ä»¶ã€‚

- jhat ï¼šè™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·

  > JVM Heap Analysis Tool ï¼Œå‘½ä»¤æ˜¯ä¸ jmap æ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚jhat å†…ç½®äº†ä¸€ä¸ªå¾®å‹ çš„HTTP/HTML æœåŠ¡å™¨ï¼Œç”Ÿæˆ dump çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚

- jstack ï¼šJava å †æ ˆè·Ÿè¸ªå·¥å…·

  > Java Stack Trace ï¼Œç”¨äºç”Ÿæˆ Java è™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚

- HSDIS ï¼šJIT ç”Ÿæˆä»£ç åç¼–è¯‘

## JDK çš„å¯è§†åŒ–å·¥å…·æœ‰å“ªäº›å¯ä»¥ç›‘æ§è™šæ‹Ÿæœºï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ4.3 JDK çš„å¯è§†åŒ–å·¥å…·ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

- Java è‡ªå¸¦

  - JConsole ï¼šJava ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°

    > Java Monitoring and Management Console æ˜¯ä» Java5 å¼€å§‹ï¼Œåœ¨ JDK ä¸­è‡ªå¸¦çš„ Java ç›‘æ§å’Œç®¡ç†æ§åˆ¶å°ï¼Œç”¨äºå¯¹ JVM ä¸­å†…å­˜ï¼Œçº¿ç¨‹å’Œç±»ç­‰çš„ç›‘æ§ã€‚

  - [VisualVM](https://blog.csdn.net/a19881029/article/details/8432368/) ï¼šå¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·

    > JDK è‡ªå¸¦å…¨èƒ½å·¥å…·ï¼Œå¯ä»¥åˆ†æå†…å­˜å¿«ç…§ã€çº¿ç¨‹å¿«ç…§ã€ç›‘æ§å†…å­˜å˜åŒ–ã€GCå˜åŒ–ç­‰ã€‚
    >
    > ç‰¹åˆ«æ˜¯ BTrace æ’ä»¶ï¼ŒåŠ¨æ€è·Ÿè¸ªåˆ†æå·¥å…·ã€‚

- ç¬¬ä¸‰æ–¹

  - MAT ï¼šå†…å­˜åˆ†æå·¥å…·

    > Memory Analyzer Tool ï¼Œä¸€ä¸ªåŸºäº Eclipse çš„å†…å­˜åˆ†æå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå¿«é€Ÿã€åŠŸèƒ½ä¸°å¯Œçš„ Java heap åˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾å†…å­˜æ³„æ¼å’Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚

  - [GChisto](http://svip.iocoder.cn/Java/VirtualMachine/Interview/GC æ—¥å¿—åˆ†æå·¥å…· â€”â€” GChisto) ï¼šä¸€æ¬¾ä¸“ä¸šåˆ†æ GC æ—¥å¿—çš„å·¥å…·ã€‚

å¦å¤–ï¼Œä¸€äº›å¼€æºé¡¹ç›®ï¼Œä¾‹å¦‚ [SkyWalking](https://github.com/apache/incubator-skywalking)ã€[Cat](https://github.com/dianping/cat) ï¼Œä¹Ÿæä¾›äº† JVM ç›‘æ§çš„åŠŸèƒ½ï¼Œæ›´åŠ é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œå¯¹ JVM çš„ç›‘æ§ã€‚

## æ€ä¹ˆè·å– Java ç¨‹åºä½¿ç”¨çš„å†…å­˜ï¼Ÿ

å¯ä»¥é€šè¿‡ `java.lang.Runtime` ç±»ä¸­ä¸å†…å­˜ç›¸å…³æ–¹æ³•æ¥è·å–å‰©ä½™çš„å†…å­˜ï¼Œæ€»å†…å­˜åŠæœ€å¤§å †å†…å­˜ã€‚é€šè¿‡è¿™äº›æ–¹æ³•ä½ ä¹Ÿå¯ä»¥è·å–åˆ°å †ä½¿ç”¨çš„ç™¾åˆ†æ¯”åŠå †å†…å­˜çš„å‰©ä½™ç©ºé—´ã€‚

- `Runtime#freeMemory()` æ–¹æ³•ï¼Œè¿”å›å‰©ä½™ç©ºé—´çš„å­—èŠ‚æ•°ã€‚
- `Runtime#totalMemory()` æ–¹æ³•ï¼Œæ€»å†…å­˜çš„å­—èŠ‚æ•°ã€‚
- `Runtime#maxMemory()` æ–¹æ³•ï¼Œè¿”å›æœ€å¤§å†…å­˜çš„å­—èŠ‚æ•°ã€‚

# è°ƒä¼˜æ¡ˆä¾‹åˆ†æä¸å®æˆ˜

åœ¨ [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œç¬¬5ç«  è°ƒä¼˜æ¡ˆä¾‹åˆ†æä¸å®æˆ˜ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ä¸­ï¼Œå·²ç»æä¾›äº†ä¸€äº›æ¡ˆä¾‹ï¼Œå»ºè®®èƒ–å‹å¯ä»¥çœ‹çœ‹ã€‚

## å¸¸è§ GC çš„ä¼˜åŒ–é…ç½®ï¼Ÿ

| é…ç½®              | æè¿°                                     |
| :---------------- | :--------------------------------------- |
| -Xms              | åˆå§‹åŒ–å †å†…å­˜å¤§å°                         |
| -Xmx              | å †å†…å­˜æœ€å¤§å€¼                             |
| -Xmn              | æ–°ç”Ÿä»£å¤§å°                               |
| -XX:PermSize      | åˆå§‹åŒ–æ°¸ä¹…ä»£å¤§å°                         |
| -XX:MaxPermSize   | æ°¸ä¹…ä»£æœ€å¤§å®¹é‡                           |
| -XX:SurvivorRatio | è®¾ç½®å¹´è½»ä»£ä¸­ Eden åŒºä¸ Survivor åŒºçš„æ¯”å€¼ |
| -XX:Xmn           | è®¾ç½®å¹´è½»ä»£å¤§å°                           |

å¦å¤–ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹ [ã€ŠJVM è°ƒä¼˜ã€‹](https://blog.csdn.net/zhaojw_420/article/details/70527138) æ–‡ç« ã€‚

## å¦‚ä½•æ’æŸ¥çº¿ç¨‹ Full GC é¢‘ç¹çš„é—®é¢˜ï¼Ÿ

- [ã€Šçº¿ä¸Š Full GC é¢‘ç¹çš„æ’æŸ¥ã€‹](https://blog.csdn.net/wilsonpeng3/article/details/70064336/)
- [ã€Šè§¦å‘ JVM è¿›è¡Œ Full GC çš„æƒ…å†µåŠåº”å¯¹ç­–ç•¥ã€‹](https://blog.csdn.net/chenleixing/article/details/46706039/)

ğŸ¦… **JVM çš„æ°¸ä¹…ä»£ä¸­ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶ä¹ˆï¼Ÿ**

- **Young GC** ä¸ä¼šå‘ç”Ÿåœ¨æ°¸ä¹…ä»£ã€‚

- å¦‚æœæ°¸ä¹…ä»£æ»¡äº†æˆ–è€…æ˜¯è¶…è¿‡äº†ä¸´ç•Œå€¼ï¼Œä¼šè§¦å‘å®Œå…¨åƒåœ¾å›æ”¶(**Full GC**)ã€‚å¦‚æœæˆ‘ä»¬ä»”ç»†æŸ¥çœ‹åƒåœ¾æ”¶é›†å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå°±ä¼šå‘ç°æ°¸ä¹…ä»£ä¹Ÿæ˜¯è¢«å›æ”¶çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ­£ç¡®çš„æ°¸ä¹…ä»£å¤§å°å¯¹é¿å… Full GC æ˜¯éå¸¸é‡è¦çš„åŸå› ã€‚

  > Java8 ï¼šä»æ°¸ä¹…ä»£åˆ°å…ƒæ•°æ®åŒº (æ³¨ï¼šJava8 ä¸­å·²ç»ç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œæ–°åŠ äº†ä¸€ä¸ªå«åšå…ƒæ•°æ®åŒºçš„ native å†…å­˜åŒº)ã€‚

## æœ‰çœ‹è¿‡ GC æ—¥å¿—ä¹ˆï¼Ÿ

> è‰¿è‰¿ï¼šè¿™ä¸ªé—®é¢˜ï¼Œä¸€èˆ¬é¢è¯•ä¸ä¼šé—®ï¼ŒåŠ è¿›æ¥ï¼Œä¸»è¦è®©èƒ–å‹çŸ¥é“ï¼Œæœ‰è¿™ä¹ˆä¸ªçŸ¥è¯†ç‚¹ã€‚

å‚è§æ–‡ç« å¦‚ä¸‹ï¼š

- [ã€Š[JVM\]ç†è§£GCæ—¥å¿—ã€‹](https://www.jianshu.com/p/fd1d4f21733a)
- [ã€ŠGC æ—¥å¿—æŸ¥çœ‹åˆ†æã€‹](https://blog.csdn.net/TimHeath/article/details/53053106)

## TODO JVM çº¿ç¨‹æ¡ˆä¾‹

TODO é—®æ™“å³°
TODO é—®é˜¿ç‰›
TODO é—®ç‹¼å“¥
TODO é—®é—ªç”µä¾ 
TODO é—®è¶…å“¥

# TODO ç±»æ–‡ä»¶ç»“æ„

# TODO è™šæ‹Ÿæœºç±»åŠ è½½æœºåˆ¶

> ç±»åŠ è½½å™¨ï¼Œæ˜¯é¢è¯•çš„é‡ç‚¹ï¼Œæ‰€ä»¥è¦æŒæ¡å¥½ã€‚å½“ç„¶ï¼Œç›¸å¯¹æ¥è¯´éš¾åº¦ä¹Ÿä¸ç®—ä¸Š~

## ç±»åŠ è½½å™¨æ˜¯æœ‰äº†è§£å—ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ7.4 ç±»åŠ è½½å™¨ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

ç±»åŠ è½½å™¨(ClassLoader)ï¼Œç”¨æ¥åŠ è½½ Java ç±»åˆ° Java è™šæ‹Ÿæœºä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒJava è™šæ‹Ÿæœºä½¿ç”¨ Java ç±»çš„æ–¹å¼å¦‚ä¸‹ï¼šJava æºç¨‹åº(`.java` æ–‡ä»¶)åœ¨ç»è¿‡ Java ç¼–è¯‘å™¨ç¼–è¯‘ä¹‹åå°±è¢«è½¬æ¢æˆ Java å­—èŠ‚ä»£ç (`.class` æ–‡ä»¶)ã€‚

ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£è¯»å– Java å­—èŠ‚ä»£ç ï¼Œå¹¶è½¬æ¢æˆ `java.lang.Class` ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚

- æ¯ä¸ªè¿™æ ·çš„å®ä¾‹ç”¨æ¥è¡¨ç¤ºä¸€ä¸ª Java ç±»ã€‚é€šè¿‡æ­¤å®ä¾‹çš„ `Class#newInstance(...)` æ–¹æ³•ï¼Œå°±å¯ä»¥åˆ›å»ºå‡ºè¯¥ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚
- å®é™…çš„æƒ…å†µå¯èƒ½æ›´åŠ å¤æ‚ï¼Œæ¯”å¦‚ Java å­—èŠ‚ä»£ç å¯èƒ½æ˜¯é€šè¿‡å·¥å…·åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯é€šè¿‡ç½‘ç»œä¸‹è½½çš„ã€‚

## ç±»åŠ è½½å‘ç”Ÿçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ7.2 ç±»åŠ è½½çš„æ—¶æœºã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

è™šæ‹Ÿæœºä¸¥æ ¼è§„å®šï¼Œæœ‰ä¸”ä»…æœ‰ 5 ç§æƒ…å†µå¿…é¡»å¯¹ç±»è¿›è¡ŒåŠ è½½ï¼š

> æ³¨æ„ï¼Œæœ‰äº›æ–‡ç« ä¼šç§°ä¸ºå¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ã€‚

- 1ã€é‡åˆ° `new`ã€`getstatic`ã€`putstatic`ã€`invokestatic` è¿™å››æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»è¿˜æ²¡è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚
- 2ã€ä½¿ç”¨ `java.lang.reflect` åŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»è¿˜æ²¡è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚
- 3ã€å½“åˆå§‹åŒ–äº†ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚
- 4ã€å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªæ‰§è¡Œçš„ä¸»ç±»ï¼Œå³è°ƒç”¨å…¶ `#main(String[] args)` æ–¹æ³•ï¼Œè™šæ‹Ÿæœºåˆ™ä¼šå…ˆåˆå§‹åŒ–è¯¥ä¸»ç±»ã€‚
- 5ã€å½“ä½¿ç”¨ JDK7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª `java.lang.invoke.MethodHandle` å®ä¾‹æœ€åçš„è§£æç»“æœä¸º REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚

## ç±»åŠ è½½å™¨æ˜¯å¦‚ä½•åŠ è½½ Class æ–‡ä»¶çš„ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ7.2 ç±»åŠ è½½çš„æ—¶æœºã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

ä¸‹å›¾æ‰€ç¤ºæ˜¯ ClassLoader åŠ è½½ä¸€ä¸ª `.class` æ–‡ä»¶åˆ° JVM æ—¶éœ€è¦ç»è¿‡çš„æ­¥éª¤ï¼š

[![ç±»åŠ è½½å™¨æ˜¯å¦‚ä½•åŠ è½½ class æ–‡ä»¶](http://static.iocoder.cn/images/JDK/2020_02_10/08.png)](http://static.iocoder.cn/images/JDK/2020_02_10/08.png)ç±»åŠ è½½å™¨æ˜¯å¦‚ä½•åŠ è½½ class æ–‡ä»¶

- ç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒåŠ è½½(Loading)ï¼Œæ˜¯æ‰¾åˆ° `.class` æ–‡ä»¶å¹¶æŠŠè¿™ä¸ªæ–‡ä»¶åŒ…å«çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ã€‚

- ç¬¬äºŒé˜¶æ®µï¼Œè¿æ¥(Linking)ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯å­—èŠ‚ç éªŒè¯ã€Class ç±»æ•°æ®ç»“æ„åˆ†æåŠç›¸åº”çš„å†…å­˜åˆ†é…ã€æœ€åçš„ç¬¦å·è¡¨çš„è§£æã€‚

- ç¬¬ä¸‰é˜¶æ®µï¼ŒInitialization(ç±»ä¸­é™æ€å±æ€§å’Œåˆå§‹åŒ–èµ‹å€¼)ï¼Œä»¥åŠUsing(é™æ€å—çš„æ‰§è¡Œ)ç­‰ã€‚

  > æ³¨æ„ï¼Œä¸åŒ…æ‹¬å¸è½½(Unloading)éƒ¨åˆ†ã€‚

ğŸ¦… **1ï¼‰åŠ è½½**

> åŠ è½½æ˜¯â€œç±»åŠ è½½â€è¿‡ç¨‹çš„ç¬¬ä¸€é˜¶æ®µï¼Œèƒ–å‹ä¸è¦æ··æ·†è¿™ä¸¤ä¸ªåå­—ã€‚

åœ¨åŠ è½½é˜¶æ®µï¼Œè™šæ‹Ÿæœºéœ€è¦å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹æƒ…ï¼š

- é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å…¶å®šä¹‰çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚
- å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚
- åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ `java.lang.Class` å¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚

ç›¸å¯¹äºç±»åŠ è½½çš„å…¶ä»–é˜¶æ®µè€Œè¨€ï¼ŒåŠ è½½é˜¶æ®µï¼ˆå‡†ç¡®åœ°è¯´ï¼Œæ˜¯åŠ è½½é˜¶æ®µè·å–ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„åŠ¨ä½œï¼‰æ˜¯å¯æ§æ€§æœ€å¼ºçš„é˜¶æ®µï¼Œå› ä¸ºå¼€å‘äººå‘˜æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ŒæˆåŠ è½½ã€‚

åŠ è½½é˜¶æ®µå®Œæˆåï¼Œè™šæ‹Ÿæœºå¤–éƒ¨çš„äºŒè¿›åˆ¶å­—èŠ‚æµå°±æŒ‰ç…§è™šæ‹Ÿæœºæ‰€éœ€çš„æ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºä¹‹ä¸­ï¼Œè€Œä¸”åœ¨Javaå †ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ª `java.lang.Class` ç±»çš„å¯¹è±¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥é€šè¿‡è¯¥å¯¹è±¡è®¿é—®æ–¹æ³•åŒºä¸­çš„è¿™äº›æ•°æ®ã€‚

ğŸ¦… **2ï¼‰åŠ è½½**

**2.1 éªŒè¯ï¼šç¡®ä¿è¢«åŠ è½½çš„ç±»çš„æ­£ç¡®æ€§**

éªŒè¯æ˜¯è¿æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ï¼Œè¿™ä¸€é˜¶æ®µçš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚

éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ4ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š

- æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šéªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒã€‚ä¾‹å¦‚ï¼šæ˜¯å¦ä»¥ `0xCAFEBABE` å¼€å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºçš„å¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡æ± ä¸­çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒçš„ç±»å‹ã€‚
- å…ƒæ•°æ®éªŒè¯ï¼šå¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆæ³¨æ„ï¼šå¯¹æ¯” javac ç¼–è¯‘é˜¶æ®µçš„è¯­ä¹‰åˆ†æï¼‰ï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚ä¾‹å¦‚ï¼šè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼Œé™¤äº† `java.lang.Object` ä¹‹å¤–ã€‚
- å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚
- ç¬¦å·å¼•ç”¨éªŒè¯ï¼šç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£ç¡®æ‰§è¡Œã€‚

éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨ `-Xverifynone` å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚

**2.2 å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼**

å‡†å¤‡é˜¶æ®µï¼Œæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š

- 1ã€è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡(`static`)ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨ Java å †ä¸­ã€‚

  > æ€è€ƒä¸‹ï¼Œå¯¹äºç±»æœ¬èº«ï¼Œé™æ€å˜é‡å°±æ˜¯å…¶å±æ€§ã€‚

- 2ã€è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼(å¦‚ `0`ã€`0L`ã€`null`ã€`false` ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨ Java ä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚

  å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š `public static int value = 3`ã€‚é‚£ä¹ˆé™æ€å˜é‡ `value` åœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º `0`ï¼Œè€Œä¸æ˜¯ `3`ã€‚å› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½• Java æ–¹æ³•ï¼Œè€ŒæŠŠ `value` èµ‹å€¼ä¸º `3` çš„ `public static` æŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äº**ç±»æ„é€ å™¨** `<clinit>()` æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠ `value` èµ‹å€¼ä¸º `3` çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚

  > è¿™é‡Œè¿˜éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š
  >
  > - å¯¹åŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¯¹äºç±»å˜é‡(`static`)å’Œå…¨å±€å˜é‡ï¼Œå¦‚æœä¸æ˜¾å¼åœ°å¯¹å…¶èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œè€Œå¯¹äºå±€éƒ¨å˜é‡æ¥è¯´ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ã€‚
  > - å¯¹äºåŒæ—¶è¢« `static` å’Œ `final` ä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ï¼›è€Œåªè¢« `final` ä¿®é¥°çš„å¸¸é‡åˆ™æ—¢å¯ä»¥åœ¨å£°æ˜æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»åˆå§‹åŒ–æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œæ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ã€‚
  > - å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ reference æ¥è¯´ï¼Œå¦‚æ•°ç»„å¼•ç”¨ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾å¼åœ°èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„ç©ºå€¼ï¼Œå³ `null` ã€‚
  > - å¦‚æœåœ¨æ•°ç»„åˆå§‹åŒ–æ—¶æ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å…ƒç´ å°†æ ¹æ®å¯¹åº”çš„æ•°æ®ç±»å‹è€Œè¢«èµ‹äºˆé»˜è®¤çš„â€œç©ºâ€å€¼ã€‚

- 3ã€å¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ ConstantValue å±æ€§ï¼Œå³åŒæ—¶è¢« `final` å’Œ `static` ä¿®é¥°ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå˜é‡ `value` å°±ä¼šè¢«åˆå§‹åŒ–ä¸º ConstValue å±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚

  å‡è®¾ä¸Šé¢çš„ç±»å˜é‡ `value` è¢«å®šä¹‰ä¸ºï¼š `public static final int value = 3` ã€‚ç¼–è¯‘æ—¶ï¼Œ `javac` å°†ä¼šä¸º `value` ç”Ÿæˆ ConstantValue å±æ€§ã€‚åœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ® ConstantValue çš„è®¾ç½®å°† `value` èµ‹å€¼ä¸º 3ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º `static final` å¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°†å…¶ç»“æœæ”¾å…¥äº†è°ƒç”¨å®ƒçš„ç±»çš„å¸¸é‡æ± ä¸­ã€‚

**2.3 è§£æï¼šæŠŠç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨**

> è¿™ä¸ªæ­¥éª¤ï¼Œè‰¿è‰¿çœ‹çš„ä¹Ÿæœ‰ç‚¹æ‡µé€¼ã€‚
>
> R å¤§åœ¨ [ã€ŠJVM ç¬¦å·å¼•ç”¨è½¬æ¢ç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹?ã€‹](https://www.zhihu.com/question/50258991) å’Œ [ã€ŠJVM é‡Œçš„ç¬¦å·å¼•ç”¨å¦‚ä½•å­˜å‚¨ï¼Ÿã€‹](https://www.zhihu.com/question/30300585) åšè¿‡è§£ç­”ï¼Œçœ‹çš„è¿˜æ˜¯æ‡µé€¼ã€‚

è§£æé˜¶æ®µï¼Œæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚è§£æåŠ¨ä½œï¼Œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚

- ç¬¦å·å¼•ç”¨ï¼Œå°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ã€‚
- ç›´æ¥å¼•ç”¨ï¼Œå°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚

ğŸ¦… **3ï¼‰åˆå§‹åŒ–**

åˆå§‹åŒ–ï¼Œä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVM è´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨ Java ä¸­å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹å€¼è®¾å®šæœ‰ä¸¤ç§æ–¹å¼ï¼š

- 1ã€å£°æ˜ç±»å˜é‡æ˜¯æŒ‡å®šåˆå§‹å€¼ã€‚
- 2ã€ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼ã€‚

JVM åˆå§‹åŒ–æ­¥éª¤ï¼š

- 1ã€å‡å¦‚è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œè¿æ¥ï¼Œåˆ™ç¨‹åºå…ˆåŠ è½½å¹¶è¿æ¥è¯¥ç±»ã€‚
- 2ã€å‡å¦‚è¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ–å…¶ç›´æ¥çˆ¶ç±»ã€‚
- 3ã€å‡å¦‚ç±»ä¸­æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ç³»ç»Ÿä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥ã€‚

## ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ7.4.2 åŒäº²å§”æ´¾æ¨¡å‹ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

ç±»åŠ è½½å™¨ ClassLoader æ˜¯å…·æœ‰å±‚æ¬¡ç»“æ„çš„ï¼Œä¹Ÿå°±æ˜¯çˆ¶å­å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

[![åŒäº²å§”æ´¾æ¨¡å‹](http://static.iocoder.cn/images/JDK/2020_02_10/09.png)](http://static.iocoder.cn/images/JDK/2020_02_10/09.png)åŒäº²å§”æ´¾æ¨¡å‹

- Bootstrap ClassLoader ï¼šæ ¹ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£åŠ è½½ Java çš„æ ¸å¿ƒç±»ï¼Œå®ƒä¸æ˜¯ `java.lang.ClassLoader` çš„å­ç±»ï¼Œè€Œæ˜¯ç”± JVM è‡ªèº«å®ç°ã€‚

  > æ­¤å¤„ï¼Œè¯´çš„æ˜¯ Hotspot çš„æƒ…å†µä¸‹ã€‚

- Extension ClassLoader ï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ‰©å±•ç±»åŠ è½½å™¨çš„åŠ è½½è·¯å¾„æ˜¯ JDK ç›®å½•ä¸‹ `jre/lib/ext` ã€‚æ‰©å±•åŠ è½½å™¨çš„ `#getParent()` æ–¹æ³•è¿”å› `null` ï¼Œå®é™…ä¸Šæ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨æ˜¯æ ¹åŠ è½½å™¨ï¼Œåªæ˜¯æ ¹åŠ è½½å™¨å¹¶ä¸æ˜¯ Java å®ç°çš„ã€‚

- System ClassLoader ï¼šç³»ç»Ÿ(åº”ç”¨)ç±»åŠ è½½å™¨ï¼Œå®ƒè´Ÿè´£åœ¨ JVM å¯åŠ¨æ—¶åŠ è½½æ¥è‡ª Java å‘½ä»¤çš„ `-classpath` é€‰é¡¹ã€`java.class.path` ç³»ç»Ÿå±æ€§æˆ– `CLASSPATH` ç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„ jar åŒ…å’Œç±»è·¯å¾„ã€‚ç¨‹åºå¯ä»¥é€šè¿‡ `#getSystemClassLoader()` æ¥è·å–ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚ç³»ç»ŸåŠ è½½å™¨çš„åŠ è½½è·¯å¾„æ˜¯ç¨‹åºè¿è¡Œçš„å½“å‰è·¯å¾„ã€‚

- è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„ Bootstrap å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å­ç±»åŠ è½½å™¨å’Œçˆ¶ç±»åŠ è½½å™¨ä¸æ˜¯ä»¥ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»æ¥å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚ç®€ç•¥ä»£ç å¦‚ä¸‹ï¼š

  ```
  // java.lang.ClassLoader
  
  public abstract class ClassLoader {
  
      // ... çœç•¥å…¶å®ƒä»£ç 
  
      // The parent class loader for delegation
      // Note: VM hardcoded the offset of this field, thus all new fields
      // must be added *after* it.
      private final ClassLoader parent;
  
  }
  ```

- æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼ˆç”±è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çˆ¶ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆã€‚

  - åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œä¸ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±»ã€‚
  - åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç±»çš„å®Œæ•´åå­—ï¼ˆåŒ…æ‹¬ç±»çš„åŒ…åï¼‰ç›¸åŒçš„ä¸¤ä¸ªç±»ï¼‰ã€‚
  - ç±»åŠ è½½å™¨è´Ÿè´£åŠ è½½æ‰€æœ‰çš„ç±»ï¼ŒåŒä¸€ä¸ªç±»(ä¸€ä¸ªç±»ç”¨å…¶å…¨é™å®šç±»å(åŒ…ååŠ ç±»å)æ ‡å¿—)åªä¼šè¢«åŠ è½½ä¸€æ¬¡ã€‚

ğŸ¦… **Java è™šæ‹Ÿæœºæ˜¯å¦‚ä½•åˆ¤å®šä¸¤ä¸ª Java ç±»æ˜¯ç›¸åŒçš„ï¼Ÿ**

Java è™šæ‹Ÿæœºä¸ä»…è¦çœ‹ç±»çš„å…¨åæ˜¯å¦ç›¸åŒï¼Œè¿˜è¦çœ‹åŠ è½½æ­¤ç±»çš„ç±»åŠ è½½å™¨æ˜¯å¦ä¸€æ ·ã€‚**åªæœ‰ä¸¤è€…éƒ½ç›¸åŒçš„æƒ…å†µï¼Œæ‰è®¤ä¸ºä¸¤ä¸ªç±»æ˜¯ç›¸åŒçš„**ã€‚å³ä¾¿æ˜¯åŒæ ·çš„å­—èŠ‚ä»£ç ï¼Œè¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ä¹‹åæ‰€å¾—åˆ°çš„ç±»ï¼Œä¹Ÿæ˜¯ä¸åŒçš„ã€‚

æ¯”å¦‚ä¸€ä¸ª Java ç±» `com.example.Sample` ï¼Œç¼–è¯‘ä¹‹åç”Ÿæˆäº†å­—èŠ‚ä»£ç æ–‡ä»¶ `Sample.class` ã€‚ä¸¤ä¸ªä¸åŒçš„ç±»åŠ è½½å™¨ ClassLoaderA å’Œ ClassLoaderB åˆ†åˆ«è¯»å–äº†è¿™ä¸ª `Sample.class` æ–‡ä»¶ï¼Œå¹¶å®šä¹‰å‡ºä¸¤ä¸ª `java.lang.Class` ç±»çš„å®ä¾‹æ¥è¡¨ç¤ºè¿™ä¸ªç±»ã€‚è¿™ä¸¤ä¸ªå®ä¾‹æ˜¯ä¸ç›¸åŒçš„ã€‚å¯¹äº Java è™šæ‹Ÿæœºæ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„ç±»ã€‚è¯•å›¾å¯¹è¿™ä¸¤ä¸ªç±»çš„å¯¹è±¡è¿›è¡Œç›¸äº’èµ‹å€¼ï¼Œä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ ClassCastException ã€‚

ğŸ¦… **åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹ï¼Ÿ**

- 1ã€å½“å‰ ClassLoader é¦–å…ˆä»è‡ªå·±å·²ç»åŠ è½½çš„ç±»ä¸­ï¼ŒæŸ¥è¯¢æ˜¯å¦æ­¤ç±»å·²ç»åŠ è½½ï¼Œå¦‚æœå·²ç»åŠ è½½åˆ™ç›´æ¥è¿”å›åŸæ¥å·²ç»åŠ è½½çš„ç±»ã€‚

  > æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰è‡ªå·±çš„åŠ è½½ç¼“å­˜ï¼Œå½“ä¸€ä¸ªç±»è¢«åŠ è½½äº†ä»¥åå°±ä¼šæ”¾å…¥ç¼“å­˜ï¼Œç­‰ä¸‹æ¬¡åŠ è½½çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚

- 2ã€å½“å‰ ClassLoader çš„ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°è¢«åŠ è½½çš„ç±»çš„æ—¶å€™

  - å§”æ‰˜çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œçˆ¶ç±»åŠ è½½å™¨é‡‡ç”¨åŒæ ·çš„ç­–ç•¥ï¼Œé¦–å…ˆæŸ¥çœ‹è‡ªå·±çš„ç¼“å­˜ï¼Œç„¶åå§”æ‰˜çˆ¶ç±»çš„çˆ¶ç±»å»åŠ è½½ï¼Œä¸€ç›´åˆ° bootstrap ClassLoaderã€‚
  - å½“æ‰€æœ‰çš„çˆ¶ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰åŠ è½½çš„æ—¶å€™ï¼Œå†ç”±å½“å‰çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¹¶å°†å…¶æ”¾å…¥å®ƒè‡ªå·±çš„ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿ä¸‹æ¬¡æœ‰åŠ è½½è¯·æ±‚çš„æ—¶å€™ç›´æ¥è¿”å›ã€‚

è®©æˆ‘ä»¬æ¥ç®€å•æ’¸ä¸‹æºç ã€‚ä»£ç å¦‚ä¸‹ï¼š

> è‰¿è‰¿ï¼šè¦ä¸è¦è·Ÿé¢è¯•å®˜å¹ä¸‹ï¼Œè‡ªå·±çœ‹è¿‡æºç å¾—çŸ¥~

```
// java.lang.ClassLoader
// åˆ é™¤éƒ¨åˆ†æ— å…³ä»£ç 

protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
    synchronized (getClassLoadingLock(name)) {
        // é¦–å…ˆï¼Œä»ç¼“å­˜ä¸­è·å¾— name å¯¹åº”çš„ç±»
        Class<?> c = findLoadedClass(name);
        if (c == null) { // è·å¾—ä¸åˆ°
            try {
                // å…¶æ¬¡ï¼Œå¦‚æœçˆ¶ç±»éç©ºï¼Œä½¿ç”¨å®ƒå»åŠ è½½ç±»
                if (parent != null) {
                    c = parent.loadClass(name, false);
                // å…¶æ¬¡ï¼Œå¦‚æœçˆ¶ç±»ä¸ºç©ºï¼Œä½¿ç”¨ Bootstrap å»åŠ è½½ç±»
                } else {
                    c = findBootstrapClassOrNull(name);
                }
            } catch (ClassNotFoundException e) {
            }

            if (c == null) { // è¿˜æ˜¯åŠ è½½ä¸åˆ°
                // æœ€å·®ï¼Œä½¿ç”¨è‡ªå·±å»åŠ è½½ç±»
                c = findClass(name);
            }
        }
        // å¦‚æœè¦è§£æç±»ï¼Œåˆ™è¿›è¡Œè§£æ
        if (resolve) {
            resolveClass(c);
        }
        return c;
    }
}
```

ğŸ¦… **ä¸ºä»€ä¹ˆä¼˜å…ˆä½¿ç”¨çˆ¶ ClassLoader åŠ è½½ç±»ï¼Ÿ**

- 1ã€å…±äº«åŠŸèƒ½ï¼šå¯ä»¥é¿å…é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»çš„æ—¶å€™ï¼Œå­ç±»ä¸éœ€è¦å†æ¬¡åŠ è½½ï¼Œä¸€äº› Framework å±‚çº§çš„ç±»ä¸€æ—¦è¢«é¡¶å±‚çš„ ClassLoader åŠ è½½è¿‡å°±ç¼“å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œä»¥åä»»ä½•åœ°æ–¹ç”¨åˆ°éƒ½ä¸éœ€è¦é‡æ–°åŠ è½½ã€‚

- 2ã€éš”ç¦»åŠŸèƒ½ï¼šä¸»è¦æ˜¯ä¸ºäº†å®‰å…¨æ€§ï¼Œé¿å…ç”¨æˆ·è‡ªå·±ç¼–å†™çš„ç±»åŠ¨æ€æ›¿æ¢ Java çš„ä¸€äº›æ ¸å¿ƒç±»ï¼Œæ¯”å¦‚ String ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†é‡å¤åŠ è½½ï¼Œå› ä¸º JVM ä¸­åŒºåˆ†ä¸åŒç±»ï¼Œä¸ä»…ä»…æ˜¯æ ¹æ®ç±»åï¼Œç›¸åŒçš„ class æ–‡ä»¶è¢«ä¸åŒçš„ ClassLoader åŠ è½½å°±æ˜¯ä¸åŒçš„ä¸¤ä¸ªç±»ï¼Œå¦‚æœç›¸äº’è½¬å‹çš„è¯ä¼šæŠ› `java.lang.ClassCaseException` ã€‚

  > è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬è‡ªå·±å®šä¹‰äº†ä¸€ä¸ª `java.util.String` ç±»ï¼Œä¹Ÿä¸ä¼šè¢«é‡å¤åŠ è½½ã€‚

## ä»€ä¹ˆæ˜¯ç ´ååŒäº²å§”æ‰˜æ¨¡å‹ï¼Ÿ

> [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œ7.4.3 ç ´ååŒäº²å§”æ´¾æ¨¡å‹ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) ã€‚

æ­£å¦‚æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æºç ï¼Œç ´ååŒäº²å§”æ‰˜æ¨¡å‹ï¼Œéœ€è¦åšçš„æ˜¯ï¼Œ`#loadClass(String name, boolean resolve)` æ–¹æ³•ä¸­ï¼Œä¸è°ƒç”¨çˆ¶ `parent` ClassLoader æ–¹æ³•å»åŠ è½½ç±»ï¼Œé‚£ä¹ˆå°±æˆåŠŸäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„ä»…ä»…æ˜¯ï¼Œé”™è¯¯çš„è¦†ç›– `##loadClass(String name, boolean resolve)` æ–¹æ³•ï¼Œä¸å»ä½¿ç”¨çˆ¶ `parent` ClassLoader æ–¹æ³•å»åŠ è½½ç±»å³å¯ã€‚

æƒ³è¦æ·±å…¥çš„èƒ–å‹ï¼Œå¯ä»¥æ·±å…¥çœ‹çœ‹å¦‚ä¸‹æ–‡ç« ï¼š

- [ã€ŠTomcat ç±»åŠ è½½å™¨ä¹‹ä¸ºä½•è¿èƒŒåŒäº²å§”æ´¾æ¨¡å‹ã€‹](https://blog.csdn.net/dangwanma6489/article/details/80244981)
- [ã€ŠçœŸæ­£ç†è§£çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆå¤šæ¡ˆä¾‹åˆ†æï¼‰ã€‹](https://blog.csdn.net/yangcheng33/article/details/52631940) æä¾›äº†å¤šç§æ‰“ç ´åŒäº²å§”æ‰˜æ¨¡å‹çš„æ¡ˆä¾‹ã€‚
- [ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹](http://gk.link/a/100kc) çš„ [ã€Œç¬¬ 9 ç«  ç±»åŠ è½½åŠæ‰§è¡Œå­ç³»ç»Ÿçš„æ¡ˆä¾‹ä¸å®æˆ˜ã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#)

ğŸ¦… **å¦‚ä½•è‡ªå®šä¹‰ ClassLoader ç±»ï¼Ÿ**

ç›´æ¥å‚è€ƒ [ã€ŠJava è‡ªå®šä¹‰ ClassLoader å®ç° JVM ç±»åŠ è½½ã€‹](https://www.jianshu.com/p/3036b46f1188) æ–‡ç« å³å¯ã€‚

ğŸ¦… **OSGI å¦‚ä½•å®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²ï¼Ÿ**

> è‰¿è‰¿ï¼šäº†è§£å³å¯ã€‚

OSGI å®ç°æ¨¡å—åŒ–çƒ­éƒ¨ç½²çš„å…³é”®ï¼Œæ˜¯å®ƒè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨æœºåˆ¶çš„å®ç°ã€‚æ¯ä¸€ä¸ªç¨‹åºæ¨¡å—éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå½“éœ€è¦ç­‰æ¢ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå°±æŠŠæ¨¡å—è¿åŒç±»åŠ è½½å™¨ä¸€èµ·æ¢æ‰ä»¥å®ç°ä»£ç çš„çƒ­æ›¿æ¢ã€‚

# TODO è™šæ‹Ÿæœºå­—èŠ‚ç æ‰§è¡Œå¼•æ“

# TODO æ—©æœŸï¼ˆç¼–è¯‘æœŸï¼‰ä¼˜åŒ–

## TODO JIT

æœ‰æ—¶æˆ‘ä»¬ä¼šå¬åˆ° JIT è¿™ä¸ªæ¦‚å¿µï¼Œå¹¶è¯´å®ƒæ˜¯ JVM çš„ä¸€éƒ¨åˆ†ï¼Œè¿™è®©æˆ‘ä»¬å¾ˆå›°æƒ‘ã€‚JIT æ˜¯ JVM çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥åœ¨åŒä¸€æ—¶é—´ç¼–è¯‘ç±»ä¼¼çš„å­—èŠ‚ç æ¥ä¼˜åŒ–å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç‰¹å®šè¯­è¨€çš„è¿‡ç¨‹ç›¸ä¼¼çš„å­—èŠ‚ç ï¼Œä»è€Œå°†ä¼˜åŒ–å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç‰¹å®šè¯­è¨€çš„è¿‡ç¨‹ï¼Œè¿™æ ·å‡å°‘è½¬æ¢è¿‡ç¨‹æ‰€éœ€è¦èŠ±è´¹çš„æ—¶é—´ã€‚

# TODO æ™šæœŸï¼ˆè¿è¡ŒæœŸï¼‰ä¼˜åŒ–

# 666. å½©è›‹

æ€»çš„æ¥è¯´ï¼ŒJVM ä¸»è¦æé—®çš„ç‚¹ï¼Œå¦‚ä¸‹è„‘å›¾ï¼š

[![è„‘å›¾](http://static.iocoder.cn/f20e86724ff310733d7556bd203dc061)](http://static.iocoder.cn/f20e86724ff310733d7556bd203dc061)è„‘å›¾

å‚è€ƒä¸æ¨èå¦‚ä¸‹æ–‡ç« ï¼š

- [ã€ŠJava é¢è¯•çŸ¥è¯†ç‚¹è§£æ(ä¸‰)â€”â€”JVMç¯‡ã€‹](https://www.cnblogs.com/wmyskxz/p/9045972.html)
- [ã€Šæ€»ç»“çš„ JVM é¢è¯•é¢˜ã€‹](https://www.jianshu.com/p/54eb60cfa7bd)
- [ã€ŠJAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ã€‹](https://troywu0.gitbooks.io/spark/content/javaå¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹.html)
- [ã€ŠJava è™šæ‹Ÿæœºè¯¦è§£ â€”â€” JVM å¸¸è§é—®é¢˜æ€»ç»“ã€‹](https://www.cnblogs.com/smyhvae/p/4810168.html)